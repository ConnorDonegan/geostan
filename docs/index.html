<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bayesian Spatial Analysis • geostan</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/united/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Bayesian Spatial Analysis">
<meta property="og:description" content="For spatial data analysis; provides exploratory spatial analysis tools, spatial regression, spatial econometric, and disease mapping models, model diagnostics, and special methods for inference with small area survey data (e.g., the America Community Survey (ACS)) and censored population health monitoring data. Models are pre-specified using the Stan programming language, a platform for Bayesian inference using Markov chain Monte Carlo (MCMC). References: Carpenter et al. (2017) &lt;doi:10.18637/jss.v076.i01&gt;; Donegan (2021) &lt;doi:10.31219/osf.io/3ey65&gt;; Donegan (2022) &lt;doi:10.21105/joss.04716&gt;; Donegan, Chun and Hughes (2020) &lt;doi:10.1016/j.spasta.2020.100450&gt;; Donegan, Chun and Griffith (2021) &lt;doi:10.3390/ijerph18136856&gt;; Morris et al. (2019) &lt;doi:10.1016/j.sste.2019.100301&gt;.">
<meta property="og:image" content="https://connordonegan.github.io/geostan/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">geostan</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.8.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li>
  <a href="articles/index.html">Articles</a>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ConnorDonegan/geostan/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">

<p><img src="reference/figures/logo.png" align="right" width="160"></p>
<div class="section level2">
<h2 id="geostan-bayesian-spatial-analysis">geostan: Bayesian spatial analysis<a class="anchor" aria-label="anchor" href="#geostan-bayesian-spatial-analysis"></a>
</h2>
<p>The <a href="https://connordonegan.github.io/geostan/">geostan</a> R package supports a complete spatial analysis workflow with Bayesian models for areal data, including a suite of functions for visualizing spatial data and model results. geostan models were built using <a href="https://mc-stan.org" class="external-link">Stan</a>, a state-of-the-art platform for Bayesian modeling.</p>
<p>Introductions to the software can be found at <a href="https://r-spatial.org/r/2024/08/02/geostan-introduction.html" class="external-link">r-spatial.org</a> and in the package <a href="https://connordonegan.github.io/geostan/articles/index.html">vignettes</a>.</p>
<p>Features include:</p>
<ul>
<li>
<strong>Spatial regression and disease mapping</strong> Statistical models for data recorded across areal units (states, counties, or census tracts) or networks, including spatial econometric models.</li>
<li>
<strong>Spatial analysis tools</strong> Tools for visualizing and measuring spatial autocorrelation and map patterns, for exploratory analysis and model diagnostics.<br>
</li>
<li>
<strong>Observational uncertainty</strong> Incorporate information on data reliability, such as standard errors of American Community Survey estimates, into any geostan model.</li>
<li>
<strong>Missing and Censored observations</strong> Vital statistics and disease surveillance systems like CDC Wonder censor case counts that fall below a threshold number; geostan can model disease or mortality risk for small areas with censored observations or with missing observations.</li>
<li>
<strong>The RStan ecosystem</strong> Interfaces easily with many high-quality R packages for Bayesian modeling.</li>
<li>
<strong>Custom spatial models</strong> Tools for building custom spatial or network models in Stan.</li>
</ul>
<p>For public health research, geostan complements the <a href="https://connordonegan.github.io/surveil/" class="external-link">surveil</a> R package for the study of time trends in disease incidence or mortality data.</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>There are two ways to install geostan: directly from the package github repository or from the Comprehensive R Archive Network (CRAN).</p>
<div class="section level3">
<h3 id="from-cran">From CRAN<a class="anchor" aria-label="anchor" href="#from-cran"></a>
</h3>
<p>Using your R console, you can install geostan from CRAN:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"geostan"</span><span class="op">)</span></span></code></pre></div>
<p>For most users, installing from CRAN is the recommended way to obtain geostan.</p>
</div>
<div class="section level3">
<h3 id="from-github">From github<a class="anchor" aria-label="anchor" href="#from-github"></a>
</h3>
<p>You can also install geostan from github:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://devtools.r-lib.org/" class="external-link">'devtools'</a></span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">'devtools'</span><span class="op">)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"connordonegan/geostan"</span><span class="op">)</span></span></code></pre></div>
<p>This requires compilation of the Stan models. If you are using Windows and installing with <code>install_github</code>, you may need to install <a href="https://cran.r-project.org/bin/windows/Rtools/" class="external-link">Rtools</a> first (this is not needed when installing from CRAN). To install Rtools:</p>
<ol style="list-style-type: decimal">
<li>Visit the Rtools site: <a href="https://cran.r-project.org/bin/windows/Rtools/" class="external-link uri">https://cran.r-project.org/bin/windows/Rtools/</a>
</li>
<li>Select the version that corresponds to the version of R that you have installed (e.g., R 4.3).</li>
<li>After selecting the correct version, look for the “Install Rtools” section (just below the introductory text) and click on the “installer” to download it. For example, for Rtools43 (for R version 4.3), click on “<span style="color:blue">Rtools43 installer</span>.”</li>
<li>Go to the <code>.exe</code> file you just downloaded and double-click to begin installation of Rtools.</li>
</ol>
<p>If you are using Mac and installing with <code>install_github</code> then you may need to install Xcode Command Line Tools first.</p>
</div>
</div>
<div class="section level2">
<h2 id="support">Support<a class="anchor" aria-label="anchor" href="#support"></a>
</h2>
<p>All functions and methods are documented (with examples) on the website <a href="https://connordonegan.github.io/geostan/reference/index.html">reference</a> page. See the package <a href="https://connordonegan.github.io/geostan/articles/index.html">vignettes</a> for more on exploratory spatial analysis, spatial measurement error models, spatial regression with raster layers, and building custom spatial model in Stan.</p>
<p>To ask questions, report a bug, or discuss ideas for improvements or new features please visit the <a href="https://github.com/ConnorDonegan/geostan/issues" class="external-link">issues</a> page, start a <a href="https://github.com/ConnorDonegan/geostan/discussions" class="external-link">discussion</a>, or submit a <a href="https://github.com/ConnorDonegan/geostan/pulls" class="external-link">pull request</a>.</p>
</div>
<div class="section level2">
<h2 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h2>
<p>Load the package and the <code>georgia</code> county mortality data set:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://connordonegan.github.io/geostan/">geostan</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; This is geostan version 0.8.1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">georgia</span><span class="op">)</span></span></code></pre></div>
<p>This has county population and mortality data by sex for ages 55-64, and for the period 2014-2018. As is common for public access data, some of the observations missing because the CDC has censored them to protect privacy.</p>
<p>The <code>sp_diag</code> function provides visual summaries of spatial data, including a histogram, Moran scatter plot, and map. The Moran scatter plot displays the values against a summary of their neighboring values, so that the slope of the regression line gives a measure of their degree of autocorrelation.</p>
<p>Here is a quick visual summary of crude female mortality rates (as deaths per 10,000):</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create adjacency matrix ("B" is for binary)</span></span>
<span><span class="va">C</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/shape2mat.html">shape2mat</a></span><span class="op">(</span><span class="va">georgia</span>, style <span class="op">=</span> <span class="st">"B"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Contiguity condition: queen</span></span>
<span><span class="co">#&gt; Number of neighbors per unit, summary:</span></span>
<span><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span><span class="co">#&gt;   1.000   4.000   5.000   5.409   6.000  10.000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Spatial weights, summary:</span></span>
<span><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span><span class="co">#&gt;       1       1       1       1       1       1</span></span>
<span></span>
<span><span class="co"># crude mortality rate per 10,000 at risk</span></span>
<span><span class="va">mortality_rate</span> <span class="op">&lt;-</span> <span class="va">georgia</span><span class="op">$</span><span class="va">rate.female</span> <span class="op">*</span> <span class="fl">10e3</span></span>
<span></span>
<span><span class="co"># quick spatial diagnostics</span></span>
<span><span class="fu"><a href="reference/sp_diag.html">sp_diag</a></span><span class="op">(</span><span class="va">mortality_rate</span>, <span class="va">georgia</span>, w <span class="op">=</span> <span class="va">C</span>, name <span class="op">=</span> <span class="st">"Mortality"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 3 NA values found in x will be dropped from data x and from matrix w (nb: this disrupts row-standardization of w)</span></span>
<span><span class="co">#&gt; Warning: Removed 3 rows containing non-finite outside the scale</span></span>
<span><span class="co">#&gt; range (`stat_bin()`).</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-3-1.png" style="display: block; margin: auto;"></p>
<p>Mortality rates and other health statistics for counties are, in many cases, highly unstable estimates that cannot be relied upon for public advisories or inference (due to small population sizes). Hence, we need models to make inferences from small area data.</p>
<p>The following code fits a spatial conditional autoregressive (CAR) model to female county mortality data. These models are used for estimating disease risk in small areas like counties, and for analyzing covariation of health outcomes with other area variables. The R syntax for fitting the models is similar to using <code>lm</code> or <code>glm</code>. We provide the population at risk (the denominator for mortality rates) as an offset term, using the log-transform.</p>
<p>In our Georgia mortality data, three of the observations are missing because they have been censored; per CDC criteria, this means that there were 9 or fewer deaths in those counties. By using the <code>censor_point</code> argument and setting it to <code>censor_point = 9</code>, we can easily obtain estimates for the censored counties (along with all the others) using models account for the censoring process:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># prepare a list of data for CAR models in Stan</span></span>
<span><span class="va">cars</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/prep_car_data.html">prep_car_data</a></span><span class="op">(</span><span class="va">C</span><span class="op">)</span></span>
<span><span class="co">#&gt; Range of permissible rho values: -1.661, 1</span></span>
<span></span>
<span><span class="co"># fit the model to female mortality rates</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/stan_car.html">stan_car</a></span><span class="op">(</span><span class="va">deaths.female</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/offset.html" class="external-link">offset</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">pop.at.risk.female</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                censor_point <span class="op">=</span> <span class="fl">9</span>,</span>
<span>        data <span class="op">=</span> <span class="va">georgia</span>,</span>
<span>        car_parts <span class="op">=</span> <span class="va">cars</span>,</span>
<span>        family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">poisson</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        iter <span class="op">=</span> <span class="fl">1e3</span>, <span class="co"># no. MCMC samples</span></span>
<span>        quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># to silence printing</span></span>
<span><span class="co">#&gt; 3 NA values identified in the outcome variable</span></span>
<span><span class="co">#&gt; Found in rows: 55, 126, 157</span></span>
<span><span class="co">#&gt; Warning: Tail Effective Samples Size (ESS) is too low, indicating posterior variances and tail quantiles may be unreliable.</span></span>
<span><span class="co">#&gt; Running the chains for more iterations may help. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#tail-ess</span></span></code></pre></div>
<p>Passing a fitted model to the <code>sp_diag</code> function will return a set of diagnostics for spatial models:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/sp_diag.html">sp_diag</a></span><span class="op">(</span><span class="va">fit</span>, <span class="va">georgia</span><span class="op">)</span></span>
<span><span class="co">#&gt; 3 NA values found in x will be dropped from data x and from matrix w (nb: this disrupts row-standardization of w)</span></span>
<span><span class="co">#&gt; Warning: Removed 3 rows containing missing values or values</span></span>
<span><span class="co">#&gt; outside the scale range (`geom_pointrange()`).</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-5-1.png" style="display: block; margin: auto;"></p>
<p>The <code>print</code> method returns a summary of the probability distributions for model parameters, as well as Markov chain Monte Carlo (MCMC) diagnostics from Stan (Monte Carlo standard errors of the mean <code>se_mean</code>, effective sample size <code>n_eff</code>, and the R-hat statistic <code>Rhat</code>):</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="co">#&gt; Spatial Model Results </span></span>
<span><span class="co">#&gt; Formula: deaths.female ~ offset(log(pop.at.risk.female))</span></span>
<span><span class="co">#&gt; Likelihood:  poisson </span></span>
<span><span class="co">#&gt; Link:  log </span></span>
<span><span class="co">#&gt; Spatial method:  CAR </span></span>
<span><span class="co">#&gt; Residual Moran Coefficient:  0.0018845 </span></span>
<span><span class="co">#&gt; Observations:  156 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Inference for Stan model: foundation.</span></span>
<span><span class="co">#&gt; 4 chains, each with iter=1000; warmup=500; thin=1; </span></span>
<span><span class="co">#&gt; post-warmup draws per chain=500, total post-warmup draws=2000.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;             mean se_mean    sd   2.5%    20%    50%    80%  97.5% n_eff  Rhat</span></span>
<span><span class="co">#&gt; intercept -4.660   0.010 0.124 -4.844 -4.728 -4.671 -4.614 -4.415   152 1.026</span></span>
<span><span class="co">#&gt; car_rho    0.926   0.002 0.057  0.788  0.884  0.938  0.974  0.997   982 1.004</span></span>
<span><span class="co">#&gt; car_scale  0.457   0.001 0.035  0.392  0.427  0.454  0.485  0.533  1869 1.001</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Samples were drawn using NUTS(diag_e) at Mon Dec 16 09:54:18 2024.</span></span>
<span><span class="co">#&gt; For each parameter, n_eff is a crude measure of effective sample size,</span></span>
<span><span class="co">#&gt; and Rhat is the potential scale reduction factor on split chains (at </span></span>
<span><span class="co">#&gt; convergence, Rhat=1).</span></span></code></pre></div>
<p>To extract estimates of the county mortality rates from this, we apply the <code>fitted</code> method - in this case, the fitted values from the model are the estimates of the county mortality rates. Multiplying them by 10,000 gives mortality rate per 10,000 at risk:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># mortality rates per 10,000 at risk</span></span>
<span><span class="va">mortality_est</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span> <span class="op">*</span> <span class="fl">10e3</span></span>
<span></span>
<span><span class="co"># display rates with county names</span></span>
<span><span class="va">county_name</span> <span class="op">&lt;-</span> <span class="va">georgia</span><span class="op">$</span><span class="va">NAME</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">county_name</span>, <span class="va">mortality_est</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="co">#&gt;           county_name      mean        sd      2.5%       20%       50%</span></span>
<span><span class="co">#&gt; fitted[1]       Crisp 101.50235  9.768276  83.48211  93.29802 101.13725</span></span>
<span><span class="co">#&gt; fitted[2]     Candler 137.44182 16.379395 109.04185 123.43893 136.64743</span></span>
<span><span class="co">#&gt; fitted[3]      Barrow  94.08506  5.891425  82.33040  89.33693  93.98641</span></span>
<span><span class="co">#&gt; fitted[4]      DeKalb  59.79313  1.558891  56.90628  58.48399  59.77942</span></span>
<span><span class="co">#&gt; fitted[5]    Columbia  53.28957  3.303941  46.98875  50.43938  53.23976</span></span>
<span><span class="co">#&gt; fitted[6]        Cobb  54.14148  1.534015  51.08186  52.88618  54.14383</span></span>
<span><span class="co">#&gt;                 80%     97.5%</span></span>
<span><span class="co">#&gt; fitted[1] 109.73107 121.20084</span></span>
<span><span class="co">#&gt; fitted[2] 151.70773 170.97029</span></span>
<span><span class="co">#&gt; fitted[3]  99.08237 105.55138</span></span>
<span><span class="co">#&gt; fitted[4]  61.05865  62.84313</span></span>
<span><span class="co">#&gt; fitted[5]  55.97967  60.21512</span></span>
<span><span class="co">#&gt; fitted[6]  55.40963  57.25577</span></span></code></pre></div>
<p>The mortality estimates are stored in the column named “mean”, and the limits of the 95% credible interval are found in the columns “2.5%” and “97.5%”. Here we create a map of estimates (with some help from <code>sf</code> package):</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Linking to GEOS 3.10.2, GDAL 3.4.3, PROJ 8.2.1; sf_use_s2() is TRUE</span></span>
<span></span>
<span><span class="co"># put estimates into bins for map colors</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">mortality_est</span><span class="op">$</span><span class="va">mean</span></span>
<span><span class="va">brks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">x</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.8</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="va">est_cut</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span><span class="va">x</span>, breaks <span class="op">=</span> <span class="va">brks</span>, include.lowest <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  </span>
<span><span class="co"># assign colors to values</span></span>
<span><span class="va">rank</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span> <span class="va">est_cut</span> <span class="op">)</span>  </span>
<span><span class="va">pal_fun</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/colorRamp.html" class="external-link">colorRampPalette</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#5D74A5FF"</span>, <span class="st">"gray90"</span>, <span class="st">"#A8554EFF"</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="va">pal</span> <span class="op">&lt;-</span> <span class="fu">pal_fun</span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">rank</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="va">colors</span> <span class="op">&lt;-</span>  <span class="va">pal</span><span class="op">[</span> <span class="va">rank</span> <span class="op">]</span></span>
<span></span>
<span><span class="co"># set plot margins</span></span>
<span><span class="va">og</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># get boundaries</span></span>
<span><span class="va">geom</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">georgia</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># map  estimates</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">geom</span>,</span>
<span>    lwd <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>    col <span class="op">=</span> <span class="va">colors</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># legend</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"right"</span>,</span>
<span>     fill <span class="op">=</span> <span class="va">pal</span>,</span>
<span>     title <span class="op">=</span> <span class="st">'Mortality per 10,000'</span>,</span>
<span>     legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">est_cut</span><span class="op">)</span>,</span>
<span>     bty <span class="op">=</span> <span class="st">'n'</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span><span class="st">'County mortality rates per 10,000, Georgia women ages 55-64'</span>, side <span class="op">=</span> <span class="fl">3</span>, font <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-8-1.png" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># reset margins</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="va">og</span><span class="op">)</span></span></code></pre></div>
<p>Using the credible intervals, we can complement our map with a point-interval plot:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># order counties by mortality rate</span></span>
<span><span class="va">index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">mortality_est</span><span class="op">$</span><span class="va">mean</span>, decreasing <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">mortality_est</span><span class="op">[</span><span class="va">index</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># gather estimate with credible interval (95%)</span></span>
<span><span class="va">est</span> <span class="op">&lt;-</span> <span class="va">dat</span><span class="op">$</span><span class="va">mean</span></span>
<span><span class="va">lwr</span> <span class="op">&lt;-</span> <span class="va">dat</span><span class="op">$</span><span class="va">`2.5%`</span></span>
<span><span class="va">upr</span> <span class="op">&lt;-</span> <span class="va">dat</span><span class="op">$</span><span class="va">`97.5%`</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">county_name</span><span class="op">)</span></span>
<span><span class="va">x_lim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">lwr</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">upr</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">og</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># points</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">est</span>,</span>
<span>     <span class="va">y</span>,</span>
<span>     pch <span class="op">=</span> <span class="fl">5</span>,</span>
<span>     col <span class="op">=</span> <span class="st">'gray50'</span>,</span>
<span>     bty <span class="op">=</span> <span class="st">'L'</span>,</span>
<span>     axes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>     xlim <span class="op">=</span> <span class="va">x_lim</span>,</span>
<span>     ylab <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>     xlab <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># intervals</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/segments.html" class="external-link">segments</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="va">lwr</span>, x1 <span class="op">=</span> <span class="va">upr</span>,</span>
<span>         y0 <span class="op">=</span> <span class="va">y</span>, y1 <span class="op">=</span> <span class="va">y</span>,</span>
<span>     col <span class="op">=</span> <span class="va">colors</span><span class="op">[</span> <span class="va">index</span> <span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># x axis</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">1</span>, at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="va">x_lim</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">x_lim</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, by <span class="op">=</span> <span class="fl">20</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span><span class="st">'County mortality rates per 10,000, Georgia women ages 55-64'</span>, side <span class="op">=</span> <span class="fl">1</span>, line <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-9-1.png" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="va">og</span><span class="op">)</span></span></code></pre></div>
<p>More details and demonstrations can be found in the package <a href="https://connordonegan.github.io/geostan/reference/index.html">help pages</a> and <a href="https://connordonegan.github.io/geostan/articles/index.html">vignettes</a>.</p>
</div>
<div class="section level2">
<h2 id="citing-geostan">Citing geostan<a class="anchor" aria-label="anchor" href="#citing-geostan"></a>
</h2>
<p>If you use geostan in published work, please include a citation.</p>
<p>Donegan, Connor (2022) “geostan: An R package for Bayesian spatial analysis” <em>The Journal of Open Source Software</em>. 7, no. 79: 4716. <a href="https://doi.org/10.21105/joss.04716" class="external-link uri">https://doi.org/10.21105/joss.04716</a>.</p>
<p><a href="https://doi.org/10.21105/joss.04716" class="external-link"><img src="https://joss.theoj.org/papers/10.21105/joss.04716/status.svg" alt="DOI"></a></p>
<div class="sourceCode" id="cb13"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true"></a><span class="op">@</span>Article{,</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true"></a>  title =<span class="st"> </span>{{geostan}<span class="op">:</span><span class="st"> </span>An {R} package <span class="cf">for</span> {B}ayesian spatial analysis},</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true"></a>  author =<span class="st"> </span>{Connor Donegan},</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true"></a>  journal =<span class="st"> </span>{The Journal of Open Source Software},</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true"></a>  year =<span class="st"> </span>{<span class="dv">2022</span>},</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true"></a>  volume =<span class="st"> </span>{<span class="dv">7</span>},</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true"></a>  number =<span class="st"> </span>{<span class="dv">79</span>},</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true"></a>  pages =<span class="st"> </span>{<span class="dv">4716</span>},</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true"></a>  doi =<span class="st"> </span>{<span class="fl">10.21105</span><span class="op">/</span>joss<span class="fl">.04716</span>},</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true"></a>}</span></code></pre></div>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=geostan" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/ConnorDonegan/geostan/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/ConnorDonegan/geostan/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small>GPL (&gt;= 3) </small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing geostan</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Connor Donegan <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-9698-5443" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li><a href="authors.html">More about authors...</a></li>
</ul>
</div>



  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by Connor Donegan.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
