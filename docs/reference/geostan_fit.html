<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>geostan_fit methods — print.geostan_fit • geostan</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/sandstone/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="geostan_fit methods — print.geostan_fit"><meta property="og:description" content="Methods for fitted geostan models: extract residuals, fitted values, posterior predictive distribution or spatial component from a spatial regression model; extract samples from the posterior distribution; print regression results; plot posterior distributions."><meta property="og:image" content="https://connordonegan.github.io/geostan/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-116873024-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-116873024-1');
</script></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">geostan</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/ConnorDonegan/geostan/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>geostan_fit methods</h1>
    <small class="dont-index">Source: <a href="https://github.com/ConnorDonegan/geostan/blob/HEAD/R/geostan_fit-methods.R" class="external-link"><code>R/geostan_fit-methods.R</code></a></small>
    <div class="hidden name"><code>geostan_fit.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Methods for fitted geostan models: extract residuals, fitted values, posterior predictive distribution or spatial component from a spatial regression model; extract samples from the posterior distribution; print regression results; plot posterior distributions.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="co"># S3 method for geostan_fit</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>
  <span class="va">x</span>,
  probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">0.975</span><span class="op">)</span>,
  digits <span class="op">=</span> <span class="fl">3</span>,
  pars <span class="op">=</span> <span class="cn">NULL</span>,
  <span class="va">...</span>
<span class="op">)</span>

<span class="co"># S3 method for geostan_fit</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">pars</span>, plotfun <span class="op">=</span> <span class="st">"hist"</span>, fill <span class="op">=</span> <span class="st">"steelblue4"</span>, <span class="va">...</span><span class="op">)</span>

<span class="co"># S3 method for geostan_fit</span>
<span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span>

<span class="co"># S3 method for geostan_fit</span>
<span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span>

<span class="co"># S3 method for geostan_fit</span>
<span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">as.array</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span>

<span class="co"># S3 method for geostan_fit</span>
<span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals</a></span><span class="op">(</span><span class="va">object</span>, summary <span class="op">=</span> <span class="cn">TRUE</span>, rates <span class="op">=</span> <span class="cn">TRUE</span>, detrend <span class="op">=</span> <span class="cn">TRUE</span>, <span class="va">...</span><span class="op">)</span>

<span class="co"># S3 method for geostan_fit</span>
<span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted</a></span><span class="op">(</span><span class="va">object</span>, summary <span class="op">=</span> <span class="cn">TRUE</span>, rates <span class="op">=</span> <span class="cn">TRUE</span>, <span class="va">...</span><span class="op">)</span>

<span class="fu">spatial</span><span class="op">(</span><span class="va">object</span>, summary <span class="op">=</span> <span class="cn">TRUE</span>, <span class="va">...</span><span class="op">)</span>

<span class="co"># S3 method for geostan_fit</span>
<span class="fu">spatial</span><span class="op">(</span><span class="va">object</span>, summary <span class="op">=</span> <span class="cn">TRUE</span>, <span class="va">...</span><span class="op">)</span>

<span class="co"># S3 method for geostan_fit</span>
<span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span>
  <span class="va">object</span>,
  <span class="va">newdata</span>,
  alpha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">object</span>, pars <span class="op">=</span> <span class="st">"intercept"</span><span class="op">)</span><span class="op">)</span>,
  center <span class="op">=</span> <span class="va">object</span><span class="op">$</span><span class="va">x_center</span>,
  summary <span class="op">=</span> <span class="cn">TRUE</span>,
  type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"link"</span>, <span class="st">"response"</span><span class="op">)</span>,
  <span class="va">...</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>x</dt>
<dd><p>A fitted model object of class <code>geostan_fit</code>.</p></dd>
<dt>probs</dt>
<dd><p>Argument passed to <code>quantile</code>; which quantiles to calculate and print.</p></dd>
<dt>digits</dt>
<dd><p>number of digits to print</p></dd>
<dt>pars</dt>
<dd><p>parameters to include; a character string (or vector) of parameter names.</p></dd>
<dt>...</dt>
<dd><p>additional arguments.</p></dd>
<dt>plotfun</dt>
<dd><p>Argument passed to <code>rstan::plot</code>. Options include histograms ("hist"), MCMC traceplots ("trace"), and density plots ("dens"). Diagnostic plots are also available such as Rhat statistics ("rhat"), effective sample size ("ess"), and MCMC autocorrelation ("ac").</p></dd>
<dt>fill</dt>
<dd><p>fill color for histograms and density plots.</p></dd>
<dt>object</dt>
<dd><p>A fitted model object of class <code>geostan_fit</code>.</p></dd>
<dt>summary</dt>
<dd><p>Logical; should the values be summarized with the mean, standard deviation and quantiles (<code>probs = c(.025, .2, .5, .8, .975)</code>) for each observation? Otherwise a matrix containing samples from the posterior distribution at each observation is returned.</p></dd>
<dt>rates</dt>
<dd><p>For Poisson and Binomial models, should the fitted values be returned as rates, as opposed to raw counts? Defaults to <code>TRUE</code>.</p></dd>
<dt>detrend</dt>
<dd><p>For CAR models with Gaussian likelihood only (auto-gaussian); if <code>detrend = TRUE</code>, the implicit spatial trend will be removed from the residuals. The implicit spatial trend is <code>Trend = rho * C %*% (Y - Mu)</code> (see <code><a href="stan_car.html">stan_car</a></code>). I.e., <code>resid = Y - (Mu + Trend)</code>.</p></dd>
<dt>newdata</dt>
<dd><p>A data frame in which to look for variables with which to predict, presumably for the purpose of viewing marginal effects. Note that if the model formula includes an offset term, <code>newdata</code> must contain a column with the appropriate name for the offset, even though the values will be ignored (you may set all values to 1); you must use the <code>alpha</code> argument to include any additional terms. Note also that any spatially-lagged covariate terms will be ignored if they were provided using the <code>slx</code> argument. If covariates in the model were centered using the <code>centerx</code> argument, the <code>predict.geostan_fit</code> method will automatically center the predictors in <code>newdata</code> internally using the values stored in <code>fit$x_center</code>. If <code>newdata</code> is missing, user arguments will be passed to the <code>fitted.geostan_fit</code> method to return the fitted values of the model.</p></dd>
<dt>alpha</dt>
<dd><p>A single numeric value or a numeric vector with length equal to <code>nrow(newdata)</code>; <code>alpha</code> serves as the intercept in the linear predictor. The default is to use the posterior mean of the intercept. Even if <code>type = "response"</code>, this needs to be provided on the scale of the linear predictor. See <code>Details</code> for additional information.</p></dd>
<dt>center</dt>
<dd><p>May be a vector of numeric values or a logical scalar to pass to <code><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></code>. Defaults to using <code>object$x_center</code>. If the model was fit using <code>centerx = TRUE</code>, then covariates were centered and their mean values are stored in <code>object$x_center</code> and the <code>predict</code> method will use them to automatically center <code>newdata</code>; if the model was fit with <code>centerx = FALSE</code>, then <code>object$x_center = FALSE</code> and <code>newdata</code> will not be centered.</p></dd>
<dt>type</dt>
<dd><p>By default, results from <code>predict</code> are on the scale of the linear predictor (<code>type = "link")</code>). The alternative (<code>type = "response"</code>) is on the scale of the response variable. For example, the default return values for a Poisson model are log-rates, and using <code>type = "response"</code> will return the rates (by exponentiating the log-rates).</p></dd>
</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>Methods <code>residuals</code>, <code>fitted</code>, <code>predict</code>, and <code>spatial</code> return a matrix containing all samples for each observation if <code>summary = FALSE</code>, else if <code>summary = TRUE</code> a <code>data.frame</code> containing a summary of the posterior distribution at each observation (of, respectively, residuals, fitted values, predicted values, or the spatial trend). The <code>predict</code> method will return a data frame with a summary of results together with use-provided <code>newdata</code>.
The <code>predict</code> method is designed for reviewing marginal effects of covariates. Thus, results do not include spatial trends or offset terms. To obtain the fitted values of the model (as opposed to predictions from new data), use the <code>fitted</code> method. For the posterior predictive distribution, see <code><a href="posterior_predict.html">posterior_predict</a></code>.
<code>plot</code> returns a <code>ggplot</code> object that can be customized using the <code>ggplot2</code> package.
<code>as.matrix</code>, <code>as.data.frame</code>, <code>as.array</code> return samples from the joint posterior distribution of parameters in the format corresponding to their names. The <code>pars</code> argument is used to return samples from only a subset of parameters.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    
<div class="section">
<h3 id="predict-geostan-fit">predict.geostan_fit<a class="anchor" aria-label="anchor" href="#predict-geostan-fit"></a></h3>


<p>The purpose of the predict method is to explore marginal effects of (combinations of) covariates. The method sets the intercept equal to its posterior mean (i.e., <code>alpha = mean(as.matrix(object, pars = "intercept"))</code>); the only source of uncertainty in the results is the posterior distribution of the coefficients, which can be obtained using <code>Beta = as.matrix(object, pars = "beta")</code>.</p>
<p>Be aware that in non-linear models (including Poisson and Binomial models) marginal effects of each covariate are sensitive to the level of other covariates in the model. If the model includes any spatially-lagged covariates (introduced using the <code>slx</code> argument) or a spatial autocorrelation term, these terms will essentially be fixed at zero for the purposes of calculating marginal effects. To explore the impact of these (missing) terms, you can add their values to the linear predictor using the <code>alpha</code> argument.</p>
</div>

    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="posterior_predict.html">posterior_predict</a></code>, <code><a href="stan_glm.html">stan_glm</a></code>, <code><a href="stan_esf.html">stan_esf</a></code>, <code><a href="stan_icar.html">stan_icar</a></code>, <code><a href="stan_car.html">stan_car</a></code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="co"># \donttest{</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">georgia</span><span class="op">)</span></span>
<span class="r-in"><span class="va">C</span> <span class="op">&lt;-</span> <span class="fu"><a href="shape2mat.html">shape2mat</a></span><span class="op">(</span><span class="va">georgia</span>, style <span class="op">=</span> <span class="st">"B"</span><span class="op">)</span></span>
<span class="r-in"><span class="va">cars</span> <span class="op">&lt;-</span> <span class="fu"><a href="prep_car_data.html">prep_car_data</a></span><span class="op">(</span><span class="va">C</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Range of permissible rho values:  -1.661134 1 </span>
<span class="r-in"><span class="va">georgia</span><span class="op">$</span><span class="va">income</span> <span class="op">&lt;-</span> <span class="va">georgia</span><span class="op">$</span><span class="va">income</span><span class="op">/</span><span class="fl">1e3</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="stan_car.html">stan_car</a></span><span class="op">(</span><span class="va">deaths.male</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/offset.html" class="external-link">offset</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">pop.at.risk.male</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">income</span><span class="op">)</span>,</span>
<span class="r-in">                slx <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">income</span><span class="op">)</span>,</span>
<span class="r-in">                centerx <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span class="r-in">                car_parts <span class="op">=</span> <span class="va">cars</span>,</span>
<span class="r-in">                data <span class="op">=</span> <span class="va">georgia</span>,</span>
<span class="r-in">                family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">poisson</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span class="r-in">                chains <span class="op">=</span> <span class="fl">2</span>, iter <span class="op">=</span> <span class="fl">600</span><span class="op">)</span> <span class="co"># for speed only</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Row standardizing connectivity matrix to calculate spatially lagged covaraite(s)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> *Setting prior parameters for intercept</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Distribution: normal</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   location scale</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1     -4.2     5</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> *Setting prior parameters for beta</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Distribution: normal</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   location scale</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1        0     5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2        0     5</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> *Setting prior for CAR scale parameter (car_scale)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Distribution: student_t</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   df location scale</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 10        0     3</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> *Setting prior for CAR spatial autocorrelation parameter (rho)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Distribution: uniform</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   lower upper</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  -1.7     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> SAMPLING FOR MODEL 'foundation' NOW (CHAIN 1).</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: Gradient evaluation took 0.000137 seconds</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 1.37 seconds.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: Adjust your expectations accordingly!</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: Iteration:   1 / 600 [  0%]  (Warmup)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: Iteration: 301 / 600 [ 50%]  (Sampling)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: Iteration: 600 / 600 [100%]  (Sampling)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1:  Elapsed Time: 0.662823 seconds (Warm-up)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1:                0.457533 seconds (Sampling)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1:                1.12036 seconds (Total)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> SAMPLING FOR MODEL 'foundation' NOW (CHAIN 2).</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 2: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 2: Gradient evaluation took 0.000251 seconds</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 2.51 seconds.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 2: Adjust your expectations accordingly!</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 2: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 2: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 2: Iteration:   1 / 600 [  0%]  (Warmup)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 2: Iteration: 301 / 600 [ 50%]  (Sampling)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 2: Iteration: 600 / 600 [100%]  (Sampling)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 2: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 2:  Elapsed Time: 0.610013 seconds (Warm-up)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 2:                0.466476 seconds (Sampling)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 2:                1.07649 seconds (Total)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 2: </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> Running the chains for more iterations may help. See</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> https://mc-stan.org/misc/warnings.html#bulk-ess</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Tail Effective Samples Size (ESS) is too low, indicating posterior variances and tail quantiles may be unreliable.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> Running the chains for more iterations may help. See</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> https://mc-stan.org/misc/warnings.html#tail-ess</span>
<span class="r-in"></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># print and plot results</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Spatial Model Results </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Formula: deaths.male ~ offset(log(pop.at.risk.male)) + log(income)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x555bebb6c2a8&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> SLX: ~log(income)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x555bebb6c2a8&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Spatial method (outcome):  CAR </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Likelihood function:  poisson </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Link function:  log </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Residual Moran Coefficient:  0.02469333 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> WAIC:  1324.35 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Observations:  159 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Data models (ME): none</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Inference for Stan model: foundation.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 chains, each with iter=600; warmup=300; thin=1; </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> post-warmup draws per chain=300, total post-warmup draws=600.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 mean se_mean    sd   2.5%    25%    50%    75%  97.5% n_eff</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> intercept     -4.158   0.001 0.016 -4.189 -4.167 -4.158 -4.148 -4.126   820</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> w.log(income) -0.039   0.004 0.104 -0.234 -0.104 -0.037  0.029  0.160   703</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> log(income)   -0.766   0.002 0.070 -0.901 -0.814 -0.768 -0.723 -0.619   994</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> car_rho        0.211   0.011 0.297 -0.397  0.014  0.235  0.409  0.775   716</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> car_scale      0.326   0.001 0.027  0.281  0.308  0.325  0.343  0.388   598</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                Rhat</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> intercept     0.999</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> w.log(income) 0.998</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> log(income)   0.999</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> car_rho       0.998</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> car_scale     0.997</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Samples were drawn using NUTS(diag_e) at Wed Jul  6 19:48:21 2022.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> For each parameter, n_eff is a crude measure of effective sample size,</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> and Rhat is the potential scale reduction factor on split chains (at </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> convergence, Rhat=1).</span>
<span class="r-in"><span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</span>
<span class="r-plt img"><img src="geostan_fit-1.png" alt="" width="700" height="433"></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># residuals</span></span>
<span class="r-in"><span class="va">r</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">resid</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># fitted values </span></span>
<span class="r-in"><span class="co"># (Poisson model defaults to rates)</span></span>
<span class="r-in"><span class="va">f1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span class="r-in"><span class="va">f2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted</a></span><span class="op">(</span><span class="va">fit</span>, rates <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># spatial diagnostics</span></span>
<span class="r-in"><span class="fu"><a href="sp_diag.html">sp_diag</a></span><span class="op">(</span><span class="va">fit</span>, <span class="va">georgia</span><span class="op">)</span></span>
<span class="r-plt img"><img src="geostan_fit-2.png" alt="" width="700" height="433"></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># spatial trend, county `random effects' </span></span>
<span class="r-in"><span class="va">sp</span> <span class="op">=</span> <span class="fu">spatial</span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># posterior predictive distribution</span></span>
<span class="r-in"><span class="va">yrep</span> <span class="op">&lt;-</span> <span class="fu"><a href="posterior_predict.html">posterior_predict</a></span><span class="op">(</span><span class="va">fit</span>, S <span class="op">=</span> <span class="fl">65</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html" class="external-link">density</a></span><span class="op">(</span><span class="va">yrep</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"gray30"</span><span class="op">)</span></span>
<span class="r-in"><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">yrep</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html" class="external-link">density</a></span><span class="op">(</span><span class="va">yrep</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"gray30"</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html" class="external-link">density</a></span><span class="op">(</span><span class="va">georgia</span><span class="op">$</span><span class="va">deaths.male</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"darkred"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span class="r-plt img"><img src="geostan_fit-3.png" alt="" width="700" height="433"></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># array of samples; MCMC diagnostics</span></span>
<span class="r-in"><span class="va">S.array</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">as.array</a></span><span class="op">(</span><span class="va">fit</span>, pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"intercept"</span>, <span class="st">"car_scale"</span>, <span class="st">"car_rho"</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="va">S.monitor</span> <span class="op">&lt;-</span> <span class="fu">rstan</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/rstan/reference/monitor.html" class="external-link">monitor</a></span><span class="op">(</span><span class="va">S.array</span>, print <span class="op">=</span> <span class="cn">FALSE</span>, warmup <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">S.monitor</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 mean      se_mean         sd       2.5%         25%        50%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> intercept -4.1579393 0.0005569084 0.01595201 -4.1890074 -4.16739163 -4.1582378</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> car_scale  0.3259890 0.0010839596 0.02690654  0.2808747  0.30760238  0.3247222</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> car_rho    0.2111443 0.0112883313 0.29657065 -0.3971391  0.01415738  0.2353164</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                  75%      97.5% n_eff      Rhat valid         Q5        Q50</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> intercept -4.1484351 -4.1257299   799 1.0058989     1 -4.1832583 -4.1582378</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> car_scale  0.3430279  0.3882203   599 0.9980219     1  0.2856492  0.3247222</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> car_rho    0.4094067  0.7745751   679 0.9987581     1 -0.2942861  0.2353164</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                  Q95   MCSE_Q2.5    MCSE_Q25     MCSE_Q50     MCSE_Q75</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> intercept -4.1304525 0.002076433 0.001005412 0.0006387937 0.0005997148</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> car_scale  0.3735426 0.001577592 0.001893591 0.0012724949 0.0016471028</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> car_rho    0.6553066 0.040796926 0.019960605 0.0136818658 0.0163040486</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            MCSE_Q97.5      MCSE_SD Bulk_ESS Tail_ESS</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> intercept 0.001076165 0.0003939338      813      462</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> car_scale 0.005018637 0.0007763440      640      499</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> car_rho   0.058623950 0.0103003434      679      442</span>
<span class="r-in"></span>
<span class="r-in"><span class="va">newdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span class="r-in">    income <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">georgia</span><span class="op">$</span><span class="va">income</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">georgia</span><span class="op">$</span><span class="va">income</span><span class="op">)</span>, by <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span class="r-in">    pop.at.risk.male <span class="op">=</span> <span class="fl">1</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit</span>, <span class="va">newdata</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">newdata</span><span class="op">$</span><span class="va">income</span>, <span class="va">p</span><span class="op">$</span><span class="va">mean</span> <span class="op">*</span> <span class="fl">1e3</span>,</span>
<span class="r-in">    type <span class="op">=</span> <span class="st">'l'</span>,</span>
<span class="r-in">     main <span class="op">=</span> <span class="st">"Deaths per 1,000"</span>,</span>
<span class="r-in">     ylab <span class="op">=</span> <span class="cn">NA</span>,</span>
<span class="r-in">     xlab <span class="op">=</span> <span class="st">"Median county income ($1,000s)"</span><span class="op">)</span></span>
<span class="r-plt img"><img src="geostan_fit-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span class="co"># }</span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Connor Donegan.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a>
2.0.1.</p>
</div>

      </footer></div>

  


  

  </body></html>

