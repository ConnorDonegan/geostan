<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Sample from the posterior predictive distribution — posterior_predict • geostan</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/united/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Sample from the posterior predictive distribution — posterior_predict"><meta property="og:description" content="Draw samples from the posterior predictive distribution of a fitted geostan model."><meta property="og:image" content="https://connordonegan.github.io/geostan/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">geostan</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.8.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/ConnorDonegan/geostan/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Sample from the posterior predictive distribution</h1>
    <small class="dont-index">Source: <a href="https://github.com/ConnorDonegan/geostan/blob/HEAD/R/posterior_predict.R" class="external-link"><code>R/posterior_predict.R</code></a></small>
    <div class="hidden name"><code>posterior_predict.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Draw samples from the posterior predictive distribution of a fitted <code>geostan</code> model.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">posterior_predict</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  <span class="va">S</span>,</span>
<span>  summary <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  width <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  approx <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  K <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  preserve_order <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">seed</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="source">
    <h2>Source</h2>
    <p>LeSage, James, &amp; Robert kelley Pace (2009). <em>Introduction to Spatial Econometrics</em>. Chapman and Hall/CRC.</p>
<p>Gelman, A., J. B.Carlin, H. S. Stern, D. B. Dunson, A. Vehtari, &amp; D. B. Rubin, D. B. (2014). <em>Bayesian data analysis</em> (3rd ed.). CRC Press.</p>
<p>McElreath, Richard (2016). <em>Statistical Rethinking: A Bayesian Course with Examples in R and Stan</em>. CRC Press, Ch. 3.</p>
    </div>
    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>object</dt>
<dd><p>A <code>geostan_fit</code> object.</p></dd>


<dt>S</dt>
<dd><p>Optional; number of samples to take from the posterior distribution. The default, and maximum, is the total number of samples stored in the model.</p></dd>


<dt>summary</dt>
<dd><p>Should the predictive distribution be summarized by its means and central quantile intervals? If <code>summary = FALSE</code>, an <code>S</code> x <code>N</code> matrix of samples will be returned. If <code>summary = TRUE</code>, then a <code>data.frame</code> with the means and <code>100*width</code> credible intervals is returned.</p></dd>


<dt>width</dt>
<dd><p>Only used if <code>summary = TRUE</code>, to set the quantiles for the credible intervals. Defaults to <code>width = 0.95</code>.</p></dd>


<dt>approx</dt>
<dd><p>For SAR models only; <code>approx = TRUE</code> uses an approximation method for the inverse of matrix <code>(I - rho * W)</code>.</p></dd>


<dt>K</dt>
<dd><p>For SAR models only; number of matrix powers to for the matrix inverse approximation (used when <code>approx = TRUE</code>). High values of rho (especially &gt; 0.9) require larger K for accurate approximation.</p></dd>


<dt>preserve_order</dt>
<dd><p>If <code>TRUE</code>, the order of posterior draws will remain fixed; the default is to permute the MCMC samples so that (with small sample size <code>S</code>) each successive call to <code>posterior_predict</code> will return a different sample from the posterior probability distribution.</p></dd>


<dt>seed</dt>
<dd><p>A single integer value to be used in a call to <code><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></code> before taking samples from the posterior distribution.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>A matrix of size S x N containing samples from the posterior predictive distribution, where S is the number of samples drawn and N is the number of observations. If <code>summary = TRUE</code>, a <code>data.frame</code> with N rows and 3 columns is returned (with column names <code>mu</code>, <code>lwr</code>, and <code>upr</code>).</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>This method returns samples from the posterior predictive distribution of the model (at the observed values of covariates, etc.). The predictions incorporate uncertainty of all parameter values (used to calculate the expected value of the model, for example) plus the error term (the model's description of the amount of variability of observations around the expected value). If the model includes measurement error in the covariates, this source of uncertainty (about \(X\)) is passed into the posterior predictive distribution as well.</p>
<p>For SAR models (and all other models), the observed outcomes are <em>not</em> used to formulate the posterior predictive distribution. The posterior predictive distribution for the SLM (see <a href="stan_sar.html">stan_sar</a>) is given by
$$(I - \rho W)^{-1} (\mu + \epsilon).$$
The SDLM is the same but includes spatially-lagged covariates in \(mu\). The <code>approx = FALSE</code> method for SAR models requires a call to <code>Matrix::solve(I - rho * W)</code> for each MCMC sample; the <code>approx = TRUE</code> method uses an approximation based on matrix powers (LeSage and Pace 2009). The approximation will deteriorate if \(\rho^K\) is not near zero, so use with care.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="va">E</span> <span class="op">&lt;-</span> <span class="va">sentencing</span><span class="op">$</span><span class="va">expected_sents</span></span>
<span><span class="va">sentencing</span><span class="op">$</span><span class="va">log_E</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">E</span><span class="op">)</span></span>
<span> <span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="stan_glm.html">stan_glm</a></span><span class="op">(</span><span class="va">sents</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/offset.html" class="external-link">offset</a></span><span class="op">(</span><span class="va">log_E</span><span class="op">)</span>,</span>
<span>                  re <span class="op">=</span> <span class="op">~</span> <span class="va">name</span>,</span>
<span>                  data <span class="op">=</span> <span class="va">sentencing</span>,</span>
<span>                  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">poisson</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                  chains <span class="op">=</span> <span class="fl">2</span>, iter <span class="op">=</span> <span class="fl">600</span><span class="op">)</span> <span class="co"># for speed only</span></span>
<span></span>
<span></span>
<span> <span class="va">yrep</span> <span class="op">&lt;-</span> <span class="fu">posterior_predict</span><span class="op">(</span><span class="va">fit</span>, S <span class="op">=</span> <span class="fl">65</span><span class="op">)</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html" class="external-link">density</a></span><span class="op">(</span><span class="va">yrep</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span> <span class="op">/</span> <span class="va">E</span> <span class="op">)</span><span class="op">)</span></span>
<span> <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">yrep</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html" class="external-link">density</a></span><span class="op">(</span><span class="va">yrep</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span> <span class="op">/</span> <span class="va">E</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">'gray30'</span><span class="op">)</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html" class="external-link">density</a></span><span class="op">(</span><span class="va">sentencing</span><span class="op">$</span><span class="va">sents</span> <span class="op">/</span> <span class="va">E</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">'darkred'</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sars</span> <span class="op">&lt;-</span> <span class="fu"><a href="prep_sar_data2.html">prep_sar_data2</a></span><span class="op">(</span>row <span class="op">=</span> <span class="fl">9</span>, col <span class="op">=</span> <span class="fl">9</span><span class="op">)</span></span>
<span><span class="va">W</span> <span class="op">&lt;-</span> <span class="va">sars</span><span class="op">$</span><span class="va">W</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="sim_sar.html">sim_sar</a></span><span class="op">(</span>rho <span class="op">=</span> <span class="fl">.9</span>, w <span class="op">=</span> <span class="va">W</span><span class="op">)</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="stan_sar.html">stan_sar</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">y</span><span class="op">)</span>, sar <span class="op">=</span> <span class="va">sars</span>,</span>
<span>                iter <span class="op">=</span> <span class="fl">650</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">yrep</span> <span class="op">&lt;-</span> <span class="fu">posterior_predict</span><span class="op">(</span><span class="va">fit</span>, S <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span>
<span></span></code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Connor Donegan.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

