<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Create spatial and space-time connectivity matrices — shape2mat • geostan</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/united/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Create spatial and space-time connectivity matrices — shape2mat"><meta property="og:description" content="Creates sparse matrix representations of spatial connectivity structures"><meta property="og:image" content="https://connordonegan.github.io/geostan/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">geostan</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.8.0.01</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/ConnorDonegan/geostan/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Create spatial and space-time connectivity matrices</h1>
    <small class="dont-index">Source: <a href="https://github.com/ConnorDonegan/geostan/blob/HEAD/R/convenience-functions.R" class="external-link"><code>R/convenience-functions.R</code></a></small>
    <div class="hidden name"><code>shape2mat.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Creates sparse matrix representations of spatial connectivity structures</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">shape2mat</span><span class="op">(</span></span>
<span>  <span class="va">shape</span>,</span>
<span>  style <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"B"</span>, <span class="st">"W"</span><span class="op">)</span>,</span>
<span>  <span class="va">queen</span>,</span>
<span>  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"queen"</span>, <span class="st">"rook"</span>, <span class="st">"knn"</span><span class="op">)</span>,</span>
<span>  k <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  longlat <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  snap <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">.Machine</span><span class="op">$</span><span class="va">double.eps</span><span class="op">)</span>,</span>
<span>  t <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  st.style <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"contemp"</span>, <span class="st">"lag"</span><span class="op">)</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="source">
    <h2>Source</h2>
    <p>Bivand, Roger S. and Pebesma, Edzer and Gomez-Rubio, Virgilio (2013). Applied spatial data analysis with R, Second edition. Springer, NY. https://asdar-book.org/</p>
<p>Griffith, Daniel A. (2012). Space, time, and space-time eigenvector filter specifications that account for autocorrelation. Estadística Espanola, 54(177), 7-34.</p>
<p>Haining, Robert P. and Li, Guangquan (2020). Modelling Spatial and Spatial-Temporal Data: A Bayesian Approach. CRC Press.</p>
    </div>
    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>shape</dt>
<dd><p>An object of class <code>sf</code>, <code>SpatialPolygons</code> or <code>SpatialPolygonsDataFrame</code>.</p></dd>


<dt>style</dt>
<dd><p>What kind of coding scheme should be used to create the spatial connectivity matrix? Defaults to "B" for binary; use "W" for row-standardized weights.</p></dd>


<dt>queen</dt>
<dd><p>Deprecated: use the `method' argument instead. This option is passed to <code><a href="https://r-spatial.github.io/spdep/reference/poly2nb.html" class="external-link">poly2nb</a></code> to set the contiguity condition. Defaults to <code>TRUE</code> so that a single shared boundary point (rather than a shared border/line) between polygons is sufficient for them to be considered neighbors.</p></dd>


<dt>method</dt>
<dd><p>Method for determining neighbors: queen, rook, or k-nearest neighbors. See Details for more information.</p></dd>


<dt>k</dt>
<dd><p>Number of neighbors to select for k-nearest neighbor method. Passed to <code><a href="https://r-spatial.github.io/spdep/reference/knearneigh.html" class="external-link">spdep::knearneigh</a></code>.</p></dd>


<dt>longlat</dt>
<dd><p>If longlat = TRUE, Great Circle (rather than Euclidean) distances are used; great circle circle distances account for curvature of the Earth.</p></dd>


<dt>snap</dt>
<dd><p>Passed to <code><a href="https://r-spatial.github.io/spdep/reference/poly2nb.html" class="external-link">spdep::poly2nb</a></code>; "boundary points less than ‘snap’ distance apart are considered to indicate contiguity."</p></dd>


<dt>t</dt>
<dd><p>Number of time periods. Only the binary coding scheme is available for space-time connectivity matrices.</p></dd>


<dt>st.style</dt>
<dd><p>For space-time data, what type of space-time connectivity structure should be used? Options are "lag" for the lagged specification and "contemp" (the default) for contemporaneous specification (see Details).</p></dd>


<dt>quiet</dt>
<dd><p>If <code>TRUE</code>, messages will be silenced.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>A spatial connectivity matrix in sparse matrix format. Binary matrices are of class <code>ngCMatrix</code>, row-standardized are of class <code>dgCMatrix</code>, created by <code><a href="https://rdrr.io/pkg/Matrix/man/sparseMatrix.html" class="external-link">sparseMatrix</a></code>.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>The method argument currently has three options. The queen contiguity condition defines neighbors as polygons that share at least one point with one another. The rook condition requires that they share a line or border with one another. K-nearest neighbors is based on distance between centroids. All methods are implemented using the spdep package and then converted to sparse matrix format.</p>
<p>Alternatively, one can use spdep directly to create a <code>listw</code> object and then convert that to a sparse matrix using <code>as(listw, 'CsparseMatrix')</code> for use with geostan.</p>
<p>Haining and Li (Ch. 4) provide a helpful discussion of spatial connectivity matrices (Ch. 4).</p>
<p>The space-time connectivity matrix can be used for eigenvector space-time filtering (<code><a href="stan_esf.html">stan_esf</a></code>. The 'lagged' space-time structure connects each observation to its own past (one period lagged) value and the past value of its neighbors. The 'contemporaneous' specification links each observation to its neighbors and to its own in situ past (one period lagged) value (Griffith 2012, p. 23).</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="edges.html">edges</a></code> <code><a href="row_standardize.html">row_standardize</a></code> <code><a href="n_nbs.html">n_nbs</a></code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">georgia</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## binary adjacency matrix</span></span>
<span><span class="va">C</span> <span class="op">&lt;-</span> <span class="fu">shape2mat</span><span class="op">(</span><span class="va">georgia</span>, <span class="st">"B"</span>, method <span class="op">=</span> <span class="st">'rook'</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## number of neighbors per observation</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span> <span class="fu"><a href="n_nbs.html">n_nbs</a></span><span class="op">(</span><span class="va">C</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">Matrix</span><span class="fu">::</span><span class="fu">summary</span><span class="op">(</span><span class="va">C</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## row-standardized matrix </span></span>
<span><span class="va">W</span> <span class="op">&lt;-</span> <span class="fu">shape2mat</span><span class="op">(</span><span class="va">georgia</span>, <span class="st">"W"</span>, method <span class="op">=</span> <span class="st">'rook'</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## summary of weights</span></span>
<span><span class="va">E</span> <span class="op">&lt;-</span> <span class="fu"><a href="edges.html">edges</a></span><span class="op">(</span><span class="va">W</span>, unique_pairs_only <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">E</span><span class="op">$</span><span class="va">weight</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## space-time matricies </span></span>
<span><span class="co">## for eigenvector space-time filtering</span></span>
<span><span class="co">## if you have multiple years with same geometry/geography,</span></span>
<span><span class="co">## provide the geometry (for a single year!) and number of years \code{t}</span></span>
<span><span class="va">Cst</span> <span class="op">&lt;-</span> <span class="fu">shape2mat</span><span class="op">(</span><span class="va">georgia</span>, t <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">Cst</span><span class="op">)</span></span>
<span><span class="va">EVst</span> <span class="op">&lt;-</span> <span class="fu"><a href="make_EV.html">make_EV</a></span><span class="op">(</span><span class="va">Cst</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">EVst</span><span class="op">)</span></span>
<span></span></code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Connor Donegan.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

