<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Generalized linear models — stan_glm • geostan</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/united/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Generalized linear models — stan_glm"><meta property="og:description" content="Fit a generalized linear model."><meta property="og:image" content="https://connordonegan.github.io/geostan/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">geostan</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.7.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/ConnorDonegan/geostan/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Generalized linear models</h1>
    <small class="dont-index">Source: <a href="https://github.com/ConnorDonegan/geostan/blob/HEAD/R/stan_glm.R" class="external-link"><code>R/stan_glm.R</code></a></small>
    <div class="hidden name"><code>stan_glm.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Fit a generalized linear model.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">stan_glm</span><span class="op">(</span></span>
<span>  <span class="va">formula</span>,</span>
<span>  <span class="va">slx</span>,</span>
<span>  <span class="va">re</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">C</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">gaussian</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  prior <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ME <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  centerx <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  prior_only <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">censor_point</span>,</span>
<span>  chains <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  iter <span class="op">=</span> <span class="fl">2000</span>,</span>
<span>  refresh <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  keep_all <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  slim <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  drop <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  pars <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  control <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="source">
    <h2>Source</h2>
    <p>Donegan, Connor and Chun, Yongwan and Griffith, Daniel A. (2021). Modeling community health with areal data: Bayesian inference with survey standard errors and spatial structure. <em>Int. J. Env. Res. and Public Health</em> 18 (13): 6856. DOI: 10.3390/ijerph18136856 Data and code: <a href="https://github.com/ConnorDonegan/survey-HBM" class="external-link">https://github.com/ConnorDonegan/survey-HBM</a>.</p>
<p>Donegan, Connor (2021). Building spatial conditional autoregressive (CAR) models in the Stan programming language. <em>OSF Preprints</em>. <a href="https://doi.org/10.31219/osf.io/3ey65" class="external-link">doi:10.31219/osf.io/3ey65</a>
.</p>
    </div>
    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>formula</dt>
<dd><p>A model formula, following the R <a href="https://rdrr.io/r/stats/formula.html" class="external-link">formula</a> syntax. Binomial models are specified by setting the left hand side of the equation to a data frame of successes and failures, as in <code>cbind(successes, failures) ~ x</code>.</p></dd>


<dt>slx</dt>
<dd><p>Formula to specify any spatially-lagged covariates. As in, <code>~ x1 + x2</code> (the intercept term will be removed internally). When setting priors for <code>beta</code>, remember to include priors for any SLX terms.</p></dd>


<dt>re</dt>
<dd><p>To include a varying intercept (or "random effects") term, <code>alpha_re</code>, specify the grouping variable here using formula syntax, as in <code>~ ID</code>. Then, <code>alpha_re</code> is a vector of parameters added to the linear predictor of the model, and:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a>alpha_re <span class="op">~</span><span class="st"> </span><span class="kw">N</span>(<span class="dv">0</span>, alpha_tau)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a>alpha_tau <span class="op">~</span><span class="st"> </span><span class="kw">Student_t</span>(d.f., location, scale).</span></code></pre><p></p></div></dd>


<dt>data</dt>
<dd><p>A <code>data.frame</code> or an object coercible to a data frame by <code>as.data.frame</code> containing the model data.</p></dd>


<dt>C</dt>
<dd><p>Optional spatial connectivity matrix which will be used to calculate residual spatial autocorrelation as well as any user specified <code>slx</code> terms; it will automatically be row-standardized before calculating <code>slx</code> terms.  See <code><a href="shape2mat.html">shape2mat</a></code>.</p></dd>


<dt>family</dt>
<dd><p>The likelihood function for the outcome variable. Current options are <code>poisson(link = "log")</code>, <code>binomial(link = "logit")</code>, <code><a href="priors.html">student_t()</a></code>, and the default <code><a href="https://rdrr.io/r/stats/family.html" class="external-link">gaussian()</a></code>.</p></dd>


<dt>prior</dt>
<dd><p>A named list of parameters for prior distributions (see <code><a href="priors.html">priors</a></code>):</p><dl><dt>intercept</dt>
<dd><p>The intercept is assigned a Gaussian prior distribution (see <code><a href="priors.html">normal</a></code></p></dd>
.

<dt>beta</dt>
<dd><p>Regression coefficients are assigned Gaussian prior distributions. Variables must follow their order of appearance in the model <code>formula</code>. Note that if you also use <code>slx</code> terms (spatially lagged covariates), and you use custom priors for <code>beta</code>, then you have to provide priors for the slx terms. Since slx terms are <em>prepended</em> to the design matrix, the prior for the slx term will be listed first.</p></dd>


<dt>sigma</dt>
<dd><p>For <code>family = gaussian()</code> and <code>family = student_t()</code> models, the scale parameter, <code>sigma</code>, is assigned a (half-) Student's t prior distribution. The half-Student's t prior for <code>sigma</code> is constrained to be positive.</p></dd>


<dt>nu</dt>
<dd><p><code>nu</code> is the degrees of freedom parameter in the Student's t likelihood (only used when <code>family = student_t()</code>). <code>nu</code> is assigned a gamma prior distribution. The default prior is <code>prior = list(nu = gamma2(alpha = 3, beta = 0.2))</code>.</p></dd>


<dt>tau</dt>
<dd><p>The scale parameter for random effects, or varying intercepts, terms. This scale parameter, <code>tau</code>, is assigned a half-Student's t prior. To set this, use, e.g., <code>prior = list(tau = student_t(df = 20, location = 0, scale = 20))</code>.</p></dd>


</dl></dd>


<dt>ME</dt>
<dd><p>To model observational uncertainty (i.e. measurement or sampling error) in any or all of the covariates, provide a list of data as constructed by the <code><a href="prep_me_data.html">prep_me_data</a></code> function.</p></dd>


<dt>centerx</dt>
<dd><p>To center predictors on their mean values, use <code>centerx = TRUE</code>. If the ME argument is used, the modeled covariate (i.e., latent variable), rather than the raw observations, will be centered. When using the ME argument, this is the recommended method for centering the covariates.</p></dd>


<dt>prior_only</dt>
<dd><p>Draw samples from the prior distributions of parameters only.</p></dd>


<dt>censor_point</dt>
<dd><p>Integer value indicating the maximum censored value; this argument is for modeling censored (suppressed) outcome data, typically disease case counts or deaths. For example, the US Centers for Disease Control and Prevention censors (does not report) death counts that are nine or fewer, so if you're using CDC WONDER mortality data you could provide <code>censor_point = 9</code>.</p></dd>


<dt>chains</dt>
<dd><p>Number of MCMC chains to estimate.</p></dd>


<dt>iter</dt>
<dd><p>Number of samples per chain.</p></dd>


<dt>refresh</dt>
<dd><p>Stan will print the progress of the sampler every <code>refresh</code> number of samples; set <code>refresh=0</code> to silence this.</p></dd>


<dt>keep_all</dt>
<dd><p>If <code>keep_all = TRUE</code> then samples for all parameters in the Stan model will be kept; this is required if you want to do model comparison with Bayes factors and the <code>bridgesampling</code> package.</p></dd>


<dt>slim</dt>
<dd><p>If <code>slim = TRUE</code>, then the Stan model will not collect the most memory-intensive parameters (including n-length vectors of fitted values, log-likelihoods, and ME-modeled covariate values). This will disable many convenience functions that are otherwise available for fitted <code>geostan</code> models, such as the extraction of residuals, fitted values, and spatial trends, WAIC, and spatial diagnostics, and ME diagnostics; many quantities of interest, such as fitted values and spatial trends, can still be calculated manually using given parameter estimates. The "slim" option is designed for data-intensive routines, such as regression with raster data, Monte Carlo studies, and measurement error models. For more control over which parameters are kept or dropped, use the <code>drop</code> argument instead of <code>slim</code>.</p></dd>


<dt>drop</dt>
<dd><p>Provide a vector of character strings to specify the names of any parameters that you do not want MCMC samples for. Dropping parameters in this way can improve sampling speed and reduce memory usage. The following parameter vectors can potentially be dropped from GLM models:</p><dl><dt>'fitted'</dt>
<dd><p>The N-length vector of fitted values</p></dd>

<dt>'alpha_re'</dt>
<dd><p>Vector of 'random effects'/varying intercepts.</p></dd>

<dt>'x_true'</dt>
<dd><p>N-length vector of 'latent'/modeled covariate values created for measurement error (ME) models.</p></dd>


</dl><p>Using <code>drop = c('fitted', 'alpha_re', 'x_true')</code> is equivalent to <code>slim = TRUE</code>. If <code>slim = TRUE</code>, then <code>drop</code> will be ignored.</p></dd>


<dt>pars</dt>
<dd><p>Specify any additional parameters you'd like stored from the Stan model.</p></dd>


<dt>control</dt>
<dd><p>A named list of parameters to control the sampler's behavior. See <a href="https://mc-stan.org/rstan/reference/stan.html" class="external-link">stan</a> for details.</p></dd>


<dt>quiet</dt>
<dd><p>Controls (most) automatic printing to the console. By default, any prior distributions that have not been assigned by the user are printed to the console. If <code>quiet = TRUE</code>, these will not be printed. Using <code>quiet = TRUE</code> will also force <code>refresh = 0</code>.</p></dd>


<dt>...</dt>
<dd><p>Other arguments passed to <a href="https://mc-stan.org/rstan/reference/stanmodel-method-sampling.html" class="external-link">sampling</a>.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>An object of class class <code>geostan_fit</code> (a list) containing:</p><dl><dt>summary</dt>
<dd><p>Summaries of the main parameters of interest; a data frame</p></dd>

<dt>diagnostic</dt>
<dd><p>Widely Applicable Information Criteria (WAIC) with a measure of effective number of parameters (<code>eff_pars</code>) and mean log pointwise predictive density (<code>lpd</code>), and mean residual spatial autocorrelation as measured by the Moran coefficient.</p></dd>

<dt>stanfit</dt>
<dd><p>an object of class <code>stanfit</code> returned by <code><a href="https://mc-stan.org/rstan/reference/stan.html" class="external-link">rstan::stan</a></code></p></dd>

<dt>data</dt>
<dd><p>a data frame containing the model data</p></dd>

<dt>family</dt>
<dd><p>the user-provided or default <code>family</code> argument used to fit the model</p></dd>

<dt>formula</dt>
<dd><p>The model formula provided by the user (not including ESF component)</p></dd>

<dt>slx</dt>
<dd><p>The <code>slx</code> formula</p></dd>

<dt>C</dt>
<dd><p>The spatial weights matrix, if one was provided by the user.</p></dd>

<dt>re</dt>
<dd><p>A list containing <code>re</code>, the random effects (varying intercepts) formula if provided, and
<code>Data</code> a data frame with columns <code>id</code>, the grouping variable, and <code>idx</code>, the index values assigned to each group.</p></dd>

<dt>priors</dt>
<dd><p>Prior specifications.</p></dd>

<dt>x_center</dt>
<dd><p>If covariates are centered internally (<code>centerx = TRUE</code>), then <code>x_center</code> is a numeric vector of the values on which covariates were centered.</p></dd>

<dt>ME</dt>
<dd><p>The <code>ME</code> data list, if one was provided by the user for measurement error models.</p></dd>

<dt>spatial</dt>
<dd><p>NA, slot is maintained for use in <code>geostan_fit</code> methods.</p></dd>


</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>Fit a generalized linear model using the R formula interface. Default prior distributions are designed to be weakly informative relative to the data. Much of the functionality intended for spatial models, such as the ability to add spatially lagged covariates and observational error models, are also available in <code>stan_glm</code>. All of <code>geostan</code>'s spatial models build on top of the same Stan code used in <code>stan_glm</code>.</p><div class="section">
<h3 id="poisson-models-and-disease-mapping">Poisson models and disease mapping<a class="anchor" aria-label="anchor" href="#poisson-models-and-disease-mapping"></a></h3>


<p>In spatial statistics, Poisson models are often used to calculate incidence rates (mortality rates, or disease incidence rates) for administrative areas like counties or census tracts. If \(y\) are counts of cases, and \(P\) are populations at risk, then the crude rates are \(y/P\). The purpose is to model risk \(\eta\) for which crude rates are a (noisy) indicator. Our analysis should also respect the fact that the amount of information contained in the observations \(y/P\) increases with \(P\). Hierarchical Poisson models are often used to incorporate all of this information.</p>
<p>For the Poisson model, \(y\) is specified as the outcome and the log of the population at risk <code>log(P)</code> needs to be provided as an offset term. For such a case, disease incidence across the collection of areas could be modeled as:</p>
<p>$$y \sim Poisson(e^{log(P) + \eta})$$
$$ \eta = \alpha + A$$
$$ A \sim Gauss(0, \tau)$$
$$\tau \sim Student(20, 0, 2)$$
where \(\alpha\) is the mean log-risk (incidence rate) and \(A\) is a vector of (so-called) random effects, which enable partial pooling of information across observations. Covariates can be added to the model for the log-rates, such that \(\eta = \alpha + X \beta + A\).</p>
<p>Note that the denominator for the rates is specified as a log-offset to provide a consistent, formula-line interface to the model. Using the log-offest (as above) is equivalent to the following:
$$
y \sim Poisson(P * e^{\eta})
$$
where \(P\) is still the population at risk and it is multiplied by \(e^{\eta}\), the incidence rate (risk).</p>
</div>

<div class="section">
<h3 id="spatially-lagged-covariates-slx-">Spatially lagged covariates (SLX)<a class="anchor" aria-label="anchor" href="#spatially-lagged-covariates-slx-"></a></h3>


<p>The <code>slx</code> argument is a convenience function for including SLX terms. For example,
$$
 y = W X \gamma + X \beta + \epsilon
$$
where \(W\) is a row-standardized spatial weights matrix (see <code><a href="shape2mat.html">shape2mat</a></code>), \(WX\) is the mean neighboring value of \(X\), and \(\gamma\) is a coefficient vector. This specifies a regression with spatially lagged covariates. SLX terms can specified by providing a formula to the <code>slx</code> argument:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="kw">stan_glm</span>(y <span class="op">~</span><span class="st"> </span>x1 <span class="op">+</span><span class="st"> </span>x2, <span class="dt">slx =</span> <span class="op">~</span><span class="st"> </span>x1 <span class="op">+</span><span class="st"> </span>x2, \...),</span></code></pre><p></p></div>
<p>which is a shortcut for</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="kw">stan_glm</span>(y <span class="op">~</span><span class="st"> </span><span class="kw">I</span>(W \<span class="op">%*\%</span><span class="st"> </span>x1) <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(W \<span class="op">%*\%</span><span class="st"> </span>x2) <span class="op">+</span><span class="st"> </span>x1 <span class="op">+</span><span class="st"> </span>x2, \...)</span></code></pre><p></p></div>
<p>SLX terms will always be <em>prepended</em> to the design matrix, as above, which is important to know when setting prior distributions for regression coefficients.</p>
<p>For measurement error (ME) models, the SLX argument is the only way to include spatially lagged covariates since the SLX term needs to be re-calculated on each iteration of the MCMC algorithm.</p>
</div>

<div class="section">
<h3 id="measurement-error-me-models">Measurement error (ME) models<a class="anchor" aria-label="anchor" href="#measurement-error-me-models"></a></h3>


<p>The ME models are designed for surveys with spatial sampling designs, such as the American Community Survey (ACS) estimates. For a tutorial, see <code><a href="../articles/spatial-me-models.html">vignette("spatial-me-models", package = "geostan")</a></code>.</p>
<p>Given estimates \(x\), their standard errors \(s\), and the target quantity of interest (i.e., the unknown true value) \(z\), the ME models have one of the the following two specifications, depending on the user input. If a spatial CAR model is specified, then:</p>
<p>$$x \sim Gauss(z, s^2)$$
$$z \sim Gauss(\mu_z, \Sigma_z)$$
$$\Sigma_z = (I - \rho C)^{-1} M$$
$$\mu_z \sim Gauss(0, 100)$$
$$\tau_z \sim Student(10, 0, 40), \tau &gt; 0$$
$$\rho_z \sim uniform(l, u)$$</p>
<p>where \(\Sigma\) specifies the covariance matrix of a spatial conditional autoregressive (CAR) model with scale parameter \(\tau\) (on the diagonal of \(M\)), autocorrelation parameter \(\rho\), and \(l\), \(u\) are the lower and upper bounds that \(\rho\) is permitted to take (which is determined by the extreme eigenvalues of the spatial connectivity matrix \(C\)). \(M\) contains the inverse of the row sums of \(C\) on its diagonal multiplied by \(\tau\) (following the "WCAR" specification).</p>
<p>For non-spatial ME models, the following is used instead:
$$x \sim Gauss(z, s^2)$$
$$z \sim student_t(\nu_z, \mu_z, \sigma_z)$$
$$\nu_z \sim gamma(3, 0.2)$$
$$\mu_z \sim Gauss(0, 100)$$
$$\sigma_z \sim student(10, 0, 40)$$</p>
<p>For strongly skewed variables, such as census tract poverty rates, it can be advantageous to apply a logit transformation to \(z\) before applying the CAR or Student-t prior model. When the <code>logit</code> argument is used, the first two lines of the model specification become:
$$x \sim Gauss(z, s^2)$$
$$logit(z) \sim Gauss(\mu_z, \Sigma_z) $$
and similarly for the Student t model:
$$x \sim Gauss(z, s^2)$$
$$logit(z) \sim student(\nu_z, \mu_z, \sigma_z)$$</p>
</div>

<div class="section">
<h3 id="missing-data">Missing data<a class="anchor" aria-label="anchor" href="#missing-data"></a></h3>


<p>For most geostan models, missing (NA) observations are allowed in the outcome variable. However, there cannot be any missing covariate data. Models that can handle missing data are: any Poisson or binomial model (GLM, SAR, CAR, ESF, ICAR), all GLMs and ESF models. The only models that cannot handle missing outcome data are the CAR and SAR models when the outcome is a continuous variable (auto-normal/Gaussian models).</p>
<p>When observations are missing, they will simply be ignored when calculating the likelihood in the MCMC sampling process (reflecting the absence of information). The estimated model parameters (including any covariates and spatial trend) will then be used to produce estimates or fitted values for the missing observations. The <code>fitted</code> and <code>posterior_predict</code> functions will work as normal in this case, and return values for all rows in your data.</p>
</div>

<div class="section">
<h3 id="censored-counts">Censored counts<a class="anchor" aria-label="anchor" href="#censored-counts"></a></h3>


<p>Vital statistics systems and disease surveillance programs typically suppress case counts when they are smaller than a specific threshold value. In such cases, the observation of a censored count is not the same as a missing value; instead, you are informed that the value is an integer somewhere between zero and the threshold value. For Poisson models (<code>family = poisson())</code>), you can use the <code>censor_point</code> argument to encode this information into your model.</p>
<p>Internally, <code>geostan</code> will keep the index values of each censored observation, and the index value of each of the fully observed outcome values. For all observed counts, the likelihood statement will be:
$$
p(y_i | data, model) = poisson(y_i | \mu_i), 
$$
as usual, where \(\mu_i\) may include whatever spatial terms are present in the model.</p>
<p>For each censored count, the likelihood statement will equal the cumulative Poisson distribution function for values zero through the censor point:
$$
p(y_i | data, model) = \sum_{m=0}^{M} Poisson( m | \mu_i),
$$
where \(M\) is the censor point and \(\mu_i\) again is the fitted value for the \(i^{th}\) observation.</p>
<p>For example, the US Centers for Disease Control and Prevention's CDC WONDER database censors all death counts between 0 and 9. To model CDC WONDER mortality data, you could provide <code>censor_point = 9</code> and then the likelihood statement for censored counts would equal the summation of the Poisson probability mass function over each integer ranging from zero through 9 (inclusive), conditional on the fitted values (i.e., all model parameters). See Donegan (2021) for additional discussion, references, and Stan code.</p>
</div>

    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Connor Donegan, <a href="mailto:connor.donegan@gmail.com">connor.donegan@gmail.com</a></p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">sentencing</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sentencing</span><span class="op">$</span><span class="va">log_e</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">sentencing</span><span class="op">$</span><span class="va">expected_sents</span><span class="op">)</span></span>
<span><span class="va">fit.pois</span> <span class="op">&lt;-</span> <span class="fu">stan_glm</span><span class="op">(</span><span class="va">sents</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/offset.html" class="external-link">offset</a></span><span class="op">(</span><span class="va">log_e</span><span class="op">)</span>,</span>
<span>                     re <span class="op">=</span> <span class="op">~</span> <span class="va">name</span>,</span>
<span>                     family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">poisson</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                     data <span class="op">=</span> <span class="va">sentencing</span>,</span>
<span>                    chains <span class="op">=</span> <span class="fl">2</span>, iter <span class="op">=</span> <span class="fl">800</span><span class="op">)</span> <span class="co"># for speed only</span></span>
<span></span>
<span><span class="co"># MCMC diagnostics plot: Rhat values should all by very near 1</span></span>
<span><span class="fu">rstan</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/rstan/reference/stan_plot_diagnostics.html" class="external-link">stan_rhat</a></span><span class="op">(</span><span class="va">fit.pois</span><span class="op">$</span><span class="va">stanfit</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># effective sample size for all parameters and generated quantities</span></span>
<span><span class="co"># (including residuals, predicted values, etc.)</span></span>
<span><span class="fu">rstan</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/rstan/reference/stan_plot_diagnostics.html" class="external-link">stan_ess</a></span><span class="op">(</span><span class="va">fit.pois</span><span class="op">$</span><span class="va">stanfit</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># or for a particular parameter</span></span>
<span><span class="fu">rstan</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/rstan/reference/stan_plot_diagnostics.html" class="external-link">stan_ess</a></span><span class="op">(</span><span class="va">fit.pois</span><span class="op">$</span><span class="va">stanfit</span>, <span class="st">"alpha_re"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Spatial autocorrelation/residual diagnostics</span></span>
<span><span class="fu"><a href="sp_diag.html">sp_diag</a></span><span class="op">(</span><span class="va">fit.pois</span>, <span class="va">sentencing</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Posterior predictive distribution                                       </span></span>
<span><span class="va">yrep</span> <span class="op">&lt;-</span> <span class="fu"><a href="posterior_predict.html">posterior_predict</a></span><span class="op">(</span><span class="va">fit.pois</span>, S <span class="op">=</span> <span class="fl">65</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">sentencing</span><span class="op">$</span><span class="va">sents</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html" class="external-link">density</a></span><span class="op">(</span><span class="va">yrep</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">yrep</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html" class="external-link">density</a></span><span class="op">(</span><span class="va">yrep</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"gray30"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/density.html" class="external-link">density</a></span><span class="op">(</span><span class="va">sentencing</span><span class="op">$</span><span class="va">sents</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"darkred"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Connor Donegan.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

