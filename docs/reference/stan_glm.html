<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Generalized linear models — stan_glm • geostan</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Generalized linear models — stan_glm" />
<meta property="og:description" content="Fit a generalized linear model." />
<meta property="og:image" content="https://connordonegan.github.io/geostan/logo.png" />






<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-116873024-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-116873024-1');
</script>


  

  

  </head>

  <body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">geostan</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/measuring-sa.html">Measuring and visualizing spatial autocorrelation</a>
    </li>
    <li>
      <a href="../articles/spatial-me-models.html">Working with American Community Survey data</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/ConnorDonegan/geostan/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Generalized linear models</h1>
    <small class="dont-index">Source: <a href='https://github.com/ConnorDonegan/geostan/blob/master/R/stan_glm.R'><code>R/stan_glm.R</code></a></small>
    <div class="hidden name"><code>stan_glm.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Fit a generalized linear model.</p>
    </div>

    <div class="ref-usage sourceCode"><pre class='sourceCode r'><code><span class='fu'>stan_glm</span><span class='op'>(</span>
  <span class='va'>formula</span>,
  <span class='va'>slx</span>,
  <span class='va'>re</span>,
  <span class='va'>data</span>,
  <span class='va'>C</span>,
  family <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/family.html'>gaussian</a></span><span class='op'>(</span><span class='op'>)</span>,
  prior <span class='op'>=</span> <span class='cn'>NULL</span>,
  ME <span class='op'>=</span> <span class='cn'>NULL</span>,
  centerx <span class='op'>=</span> <span class='cn'>FALSE</span>,
  prior_only <span class='op'>=</span> <span class='cn'>FALSE</span>,
  chains <span class='op'>=</span> <span class='fl'>4</span>,
  iter <span class='op'>=</span> <span class='fl'>2000</span>,
  refresh <span class='op'>=</span> <span class='fl'>1000</span>,
  pars <span class='op'>=</span> <span class='cn'>NULL</span>,
  control <span class='op'>=</span> <span class='cn'>NULL</span>,
  <span class='va'>...</span>
<span class='op'>)</span></code></pre></div>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>formula</th>
      <td><p>A model formula, following the R <a href='https://rdrr.io/r/stats/formula.html'>formula</a> syntax. Binomial models are specified by setting the left hand side of the equation to a data frame of successes and failures, as in <code>cbind(successes, failures) ~ x</code>.</p></td>
    </tr>
    <tr>
      <th>slx</th>
      <td><p>Formula to specify any spatially-lagged covariates. As in, <code>~ x1 + x2</code> (the intercept term will be removed internally). When setting priors for <code>beta</code>, remember to include priors for any SLX terms.</p></td>
    </tr>
    <tr>
      <th>re</th>
      <td><p>To include a varying intercept (or "random effects") term, <code>alpha_re</code>, specify the grouping variable here using formula syntax, as in <code>~ ID</code>. Then, <code>alpha_re</code> is a vector of parameters added to the linear predictor of the model, and:</p><pre><code>       alpha_re ~ N(0, alpha_tau)
       alpha_tau ~ Student_t(d.f., location, scale).
</code></pre></td>
    </tr>
    <tr>
      <th>data</th>
      <td><p>A <code>data.frame</code> or an object coercible to a data frame by <code>as.data.frame</code> containing the model data.</p></td>
    </tr>
    <tr>
      <th>C</th>
      <td><p>Optional spatial connectivity matrix which will be used to calculate residual spatial autocorrelation as well as any user specified <code>slx</code> terms; it will automatically be row-standardized before calculating <code>slx</code> terms.  See <code><a href='shape2mat.html'>shape2mat</a></code>.</p></td>
    </tr>
    <tr>
      <th>family</th>
      <td><p>The likelihood function for the outcome variable. Current options are <code>poisson(link = "log")</code>, <code>binomial(link = "logit")</code>, <code><a href='priors.html'>student_t()</a></code>, and the default <code><a href='https://rdrr.io/r/stats/family.html'>gaussian()</a></code>.</p></td>
    </tr>
    <tr>
      <th>prior</th>
      <td><p>A named list of parameters for prior distributions (see <code><a href='priors.html'>priors</a></code>):</p><dl>

<dt>intercept</dt><dd><p>The intercept is assigned a Gaussian prior distribution (see <code><a href='priors.html'>normal</a></code></p></dd>.

<dt>beta</dt><dd><p>Regression coefficients are assigned Gaussian prior distributions. Variables must follow their order of appearance in the model <code>formula</code>. Note that if you also use <code>slx</code> terms (spatially lagged covariates), and you use custom priors for <code>beta</code>, then you have to provide priors for the slx terms. Since slx terms are <em>prepended</em> to the design matrix, the prior for the slx term will be listed first.</p></dd>

<dt>sigma</dt><dd><p>For <code>family = gaussian()</code> and <code>family = student_t()</code> models, the scale parameter, <code>sigma</code>, is assigned a (half-) Student's t prior distribution. The half-Student's t prior for <code>sigma</code> is constrained to be positive.</p></dd>

<dt>nu</dt><dd><p><code>nu</code> is the degrees of freedom parameter in the Student's t likelihood (only used when <code>family = student_t()</code>). <code>nu</code> is assigned a gamma prior distribution. The default prior is <code>prior = list(nu = gamma(alpha = 3, beta = 0.2))</code>.</p></dd>

<dt>tau</dt><dd><p>The scale parameter for random effects, or varying intercepts, terms. This scale parameter, <code>tau</code>, is assigned a half-Student's t prior. To set this, use, e.g., <code>prior = list(tau = student_t(df = 20, location = 0, scale = 20))</code>.</p></dd>

</dl></td>
    </tr>
    <tr>
      <th>ME</th>
      <td><p>To model observational uncertainty (i.e. measurement or sampling error) in any or all of the covariates, provide a named list of priors. See the Details section below for more information. Elements of the <code>ME</code> list may include:</p><dl>

<dt>se</dt><dd><p>A required dataframe with standard errors for each observation; columns will be matched to the variables by column names. The names should match those from the output of <code>model.matrix(formula, data)</code>.</p></dd>

<dt>bounds</dt><dd><p>An optional numeric vector of length two providing the upper and lower bounds, respectively, of the variables. If not provided, they will be set to <code>c(-Inf, Inf)</code> (i.e., unbounded). Common usages include keeping percentages between zero and one hundred or proportions between zero and one.</p></dd>

<dt>car_parts</dt><dd><p>A list of data for the CAR model, as returned by <code><a href='prep_car_data.html'>prep_car_data</a></code>. If not provided, a non-spatial Student's t model will be used instead of the CAR model.</p></dd>

<dt>prior</dt><dd><p>Optionally provide a named list of prior distributions for the measurement error model(s) (see <code><a href='priors.html'>priors</a></code>). If none are provided, default priors will be assigned and printed to the console. <dl><dt>df</dt><dd><p>If using a non-spatial ME model, the degrees of freedom for the Student's t model is assigned a gamma prior with default parameters of <code>gamma(alpha = 3, beta = 0.2)</code>. Provide values for each covariate in <code>se</code>, listing the values in the same order as the columns of <code>se</code>.</p></dd><dt>car_rho</dt><dd><p>The CAR model also has a spatial autocorrelation parameter, <code>rho</code>, which is assigned a uniform prior distribution. You can set the boundaries of the prior with: <code>ME$prior$car_rho &lt;- uniform(lower_bound, upper_bound)</code>. You must specify values that are within the permissible range of values for <code>rho</code>. This range is automatically printed to the console by <code><a href='prep_car_data.html'>prep_car_data</a></code>.</p></dd><dt>location</dt><dd><p>The prior for the location parameter, mu, is Gaussian (the default being <code>normal(location = 0, scale = 100)</code>). To adjust the prior distributions, provide values for each covariate in <code>se</code>, listing the values in the same order as the columns of <code>se</code>.</p></dd><dt>scale</dt><dd><p>The prior for the <code>scale</code> parameters is Student's t, and the default is <code>student_t(df = 10, location = 0, scale = 40)</code>. To adjust, provide values for each covariate in <code>se</code>, listing the values in the same order as the columns of <code>se</code>.</p></dd></dl></p></dd>

</dl></td>
    </tr>
    <tr>
      <th>centerx</th>
      <td><p>To center predictors on their mean values, use <code>centerx = TRUE</code>. If <code>centerx</code> is a numeric vector, predictors will be centered on the values provided. This argument is passed to <code><a href='https://rdrr.io/r/base/scale.html'>scale</a></code>.</p></td>
    </tr>
    <tr>
      <th>prior_only</th>
      <td><p>Draw samples from the prior distributions of parameters only.</p></td>
    </tr>
    <tr>
      <th>chains</th>
      <td><p>Number of MCMC chains to estimate.</p></td>
    </tr>
    <tr>
      <th>iter</th>
      <td><p>Number of samples per chain.</p></td>
    </tr>
    <tr>
      <th>refresh</th>
      <td><p>Stan will print the progress of the sampler every <code>refresh</code> number of samples; set <code>refresh=0</code> to silence this.</p></td>
    </tr>
    <tr>
      <th>pars</th>
      <td><p>Specify any additional parameters you'd like stored from the Stan model.</p></td>
    </tr>
    <tr>
      <th>control</th>
      <td><p>A named list of parameters to control the sampler's behavior. See <a href='https://mc-stan.org/rstan/reference/stan.html'>stan</a> for details.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Other arguments passed to <a href='https://mc-stan.org/rstan/reference/stanmodel-method-sampling.html'>sampling</a>. For multi-core processing, you can use <code>cores = parallel::detectCores()</code>, or run <code>options(mc.cores = parallel::detectCores())</code> first.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="source"><a class="anchor" href="#source"></a>Source</h2>

    <p>Donegan, Connor and Chun, Yongwan and Griffith, Daniel A. (2021). Modeling community health with areal data: Bayesian inference with survey standard errors and spatial structure. <em>Int. J. Env. Res. and Public Health</em> 18 (13): 6856. DOI: 10.3390/ijerph18136856 Data and code: <a href='https://github.com/ConnorDonegan/survey-HBM'>https://github.com/ConnorDonegan/survey-HBM</a>.</p>
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>An object of class class <code>geostan_fit</code> (a list) containing:</p><dl>
<dt>summary</dt><dd><p>Summaries of the main parameters of interest; a data frame</p></dd>
<dt>diagnostic</dt><dd><p>Widely Applicable Information Criteria (WAIC) with a measure of effective number of parameters (<code>eff_pars</code>) and mean log pointwise predictive density (<code>lpd</code>), and mean residual spatial autocorrelation as measured by the Moran coefficient.</p></dd>
<dt>stanfit</dt><dd><p>an object of class <code>stanfit</code> returned by <code><a href='https://mc-stan.org/rstan/reference/stan.html'>rstan::stan</a></code></p></dd>
<dt>data</dt><dd><p>a data frame containing the model data</p></dd>
<dt>family</dt><dd><p>the user-provided or default <code>family</code> argument used to fit the model</p></dd>
<dt>formula</dt><dd><p>The model formula provided by the user (not including ESF component)</p></dd>
<dt>slx</dt><dd><p>The <code>slx</code> formula</p></dd>
<dt>re</dt><dd><p>A list containing <code>re</code>, the random effects (varying intercepts) formula if provided, and
<code>Data</code> a data frame with columns <code>id</code>, the grouping variable, and <code>idx</code>, the index values assigned to each group.</p></dd>
<dt>priors</dt><dd><p>Prior specifications.</p></dd>
<dt>x_center</dt><dd><p>If covariates are centered internally (i.e., <code>centerx</code> is not <code>FALSE</code>), then <code>x_centers</code> is the numeric vector of values on which the covariates were centered.</p></dd>
<dt>ME</dt><dd><p>The <code>ME</code> data list, if one was provided by the user for measurement error models.</p></dd>
<dt>spatial</dt><dd><p>NA, slot is maintained for use in <code>geostan_fit</code> methods.</p></dd>

</dl>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Fit a generalized linear model using the R formula interface. Default prior distributions are designed to be weakly informative relative to the data. Much of the functionality intended for spatial models, such as the ability to add spatially lagged covariates and observational error models, are also available in <code>stan_glm</code>. All of <code>geostan</code>'s spatial models build on top of the same Stan code used in <code>stan_glm</code>.</p><h3 class='hasAnchor' id='poisson-models-and-disease-mapping'><a class='anchor' aria-hidden='true' href='#poisson-models-and-disease-mapping'></a>Poisson models and disease mapping</h3>


<p>In spatial statistics, Poisson models are often used to calculate incidence rates (mortality rates, or disease incidence rates) for administrative areas like counties or census tracts. If <code>Y</code> are counts of cases, and <code>P</code> are populations at risk, then the crude rates are <code>Y/P</code>. For a Poisson model, <code>Y</code> is the outcome and the user should provide an offset value of <code>log(P)</code>. For such a case, disease incidence across the collection of areas could be modeled as:</p><pre><code>        Y ~ Poisson(exp(offset + Mu))
        Mu = alpha + A
        A ~ Guass(0, tau)
        tau ~ student(20, 0, 2),
</code></pre>

<p>where <code>alpha</code> is the mean log-risk (incidence rate) and <code>A</code> is a vector of (so-called) random effects, which enable partial pooling of information across observations. See the example section of this document for a demonstration (where the denominator of the outcome is the expected count, rather than population at risk).</p>

<h3 class='hasAnchor' id='spatially-lagged-covariates-slx-'><a class='anchor' aria-hidden='true' href='#spatially-lagged-covariates-slx-'></a>Spatially lagged covariates (SLX)</h3>


<p>The <code>slx</code> argument is a convenience function for including SLX terms. For example,</p><pre class='sourceCode r'><code><span class='fu'>stan_glm</span><span class='op'>(</span><span class='va'>y</span> <span class='op'>~</span> <span class='va'>x1</span> <span class='op'>+</span> <span class='va'>x2</span>, slx <span class='op'>=</span> <span class='op'>~</span> <span class='va'>x1</span>, <span class='va'>...</span><span class='op'>)</span>
</code></pre>

<p>is a shortcut for</p><pre class='sourceCode r'><code><span class='fu'>stan_glm</span><span class='op'>(</span><span class='va'>y</span> <span class='op'>~</span> <span class='fu'><a href='https://rdrr.io/r/base/AsIs.html'>I</a></span><span class='op'>(</span><span class='va'>W</span> <span class='op'><a href='https://rdrr.io/r/base/matmult.html'>%*%</a></span> <span class='va'>x1</span><span class='op'>)</span> <span class='op'>+</span> <span class='va'>x1</span> <span class='op'>+</span> <span class='va'>x2</span>, <span class='va'>...</span><span class='op'>)</span>
</code></pre>

<p>where <code>W</code> is a row-standardized spatial weights matrix (see <code><a href='shape2mat.html'>shape2mat</a></code>). SLX terms will always be <em>prepended</em> to the design matrix, as above, which is important to know when setting prior distributions for regression coefficients.</p>
<p>For measurement error (ME) models, the SLX argument is the only way to include spatially lagged covariates since the SLX term needs to be re-calculated on each iteration of the MCMC algorithm.</p>

<h3 class='hasAnchor' id='measurement-error-me-models'><a class='anchor' aria-hidden='true' href='#measurement-error-me-models'></a>Measurement error (ME) models</h3>


<p>The ME models are designed for surveys with spatial sampling designs, such as the American Community Survey (ACS) estimates. With estimates, <code>x</code>, and their standard errors, <code>se</code>, the ME models have one of the the following two specifications, depending on the user input:</p><pre><code>       x ~ Gauss(x_true, se)
       x_true ~ MVGauss(mu, Sigma)
       Sigma = (I - rho * C)^(-1) M * tau^2
       mu ~ Gauss(0, 100)
       tau ~ student_t(10, 0, 40)
       rho ~ uniform(lower_bound, upper_bound)
</code></pre>

<p>where the covariance matrix, <code>Sigma</code>, has the conditional autoregressive specification, and <code>tau</code> is the scale parameter. If <code>ME$car_parts</code> is not provided by the user, then a non-spatial model will be used instead:</p><pre class='sourceCode r'><code>       <span class='va'>x</span> <span class='op'>~</span> <span class='fu'>Gauss</span><span class='op'>(</span><span class='va'>x_true</span>, <span class='va'>se</span><span class='op'>)</span>
       <span class='va'>x_true</span> <span class='op'>~</span> <span class='fu'><a href='priors.html'>student_t</a></span><span class='op'>(</span><span class='va'>df</span>, <span class='va'>mu</span>, <span class='va'>sigma</span><span class='op'>)</span>
       <span class='va'>df</span> <span class='op'>~</span> <span class='fu'><a href='priors.html'>gamma</a></span><span class='op'>(</span><span class='fl'>3</span>, <span class='fl'>0.2</span><span class='op'>)</span>
       <span class='va'>mu</span> <span class='op'>~</span> <span class='fu'>Gauss</span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>100</span><span class='op'>)</span>
       <span class='va'>sigma</span> <span class='op'>~</span> <span class='fu'><a href='priors.html'>student_t</a></span><span class='op'>(</span><span class='fl'>10</span>, <span class='fl'>0</span>, <span class='fl'>40</span><span class='op'>)</span>
</code></pre>

<p>The observational error is the difference between the survey estimate and <code>x_true</code>, the actual value of the variable during the period of the survey.</p>

    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>Connor Donegan, <a href='mailto:Connor.Donegan@UTDallas.edu'>Connor.Donegan@UTDallas.edu</a></p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <div class="ref-examples sourceCode"><pre class='sourceCode r'><code><span class='r-in'><span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span></span>
<span class='r-in'><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://ggplot2.tidyverse.org'>ggplot2</a></span><span class='op'>)</span></span>
<span class='r-in'><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://r-spatial.github.io/sf/'>sf</a></span><span class='op'>)</span></span>
<span class='r-in'><span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>sentencing</span><span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='va'>sentencing</span><span class='op'>$</span><span class='va'>log_e</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>sentencing</span><span class='op'>$</span><span class='va'>expected_sents</span><span class='op'>)</span></span>
<span class='r-in'><span class='va'>fit.pois</span> <span class='op'>&lt;-</span> <span class='fu'>stan_glm</span><span class='op'>(</span><span class='va'>sents</span> <span class='op'>~</span> <span class='fu'><a href='https://rdrr.io/r/stats/offset.html'>offset</a></span><span class='op'>(</span><span class='va'>log_e</span><span class='op'>)</span>,</span>
<span class='r-in'>                     re <span class='op'>=</span> <span class='op'>~</span> <span class='va'>name</span>,</span>
<span class='r-in'>                     family <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/family.html'>poisson</a></span><span class='op'>(</span><span class='op'>)</span>,</span>
<span class='r-in'>                     data <span class='op'>=</span> <span class='va'>sentencing</span></span>
<span class='r-in'> <span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># MCMC diagnostics plot: Rhat values should all by very near 1</span></span>
<span class='r-in'><span class='fu'>rstan</span><span class='fu'>::</span><span class='fu'><a href='https://mc-stan.org/rstan/reference/stan_plot_diagnostics.html'>stan_rhat</a></span><span class='op'>(</span><span class='va'>fit.pois</span><span class='op'>$</span><span class='va'>stanfit</span><span class='op'>)</span></span>
<span class='r-in'> <span class='co'># see effective sample size for all parameters and generated quantities</span></span>
<span class='r-in'> <span class='co'># (including residuals, predicted values, etc.)</span></span>
<span class='r-in'><span class='fu'>rstan</span><span class='fu'>::</span><span class='fu'><a href='https://mc-stan.org/rstan/reference/stan_plot_diagnostics.html'>stan_ess</a></span><span class='op'>(</span><span class='va'>fit.pois</span><span class='op'>$</span><span class='va'>stanfit</span><span class='op'>)</span></span>
<span class='r-in'><span class='co'># or for a particular parameter</span></span>
<span class='r-in'><span class='fu'>rstan</span><span class='fu'>::</span><span class='fu'><a href='https://mc-stan.org/rstan/reference/stan_plot_diagnostics.html'>stan_ess</a></span><span class='op'>(</span><span class='va'>fit.pois</span><span class='op'>$</span><span class='va'>stanfit</span>, <span class='st'>"alpha_re"</span><span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'># Spatial autocorrelation/residual diagnostics</span></span>
<span class='r-in'><span class='fu'><a href='sp_diag.html'>sp_diag</a></span><span class='op'>(</span><span class='va'>fit.pois</span>, <span class='va'>sentencing</span><span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'>## Posterior predictive distribution                                       </span></span>
<span class='r-in'><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://mc-stan.org/bayesplot/'>bayesplot</a></span><span class='op'>)</span></span>
<span class='r-in'><span class='va'>yrep</span> <span class='op'>&lt;-</span> <span class='fu'><a href='posterior_predict.html'>posterior_predict</a></span><span class='op'>(</span><span class='va'>fit.pois</span>, samples <span class='op'>=</span> <span class='fl'>75</span><span class='op'>)</span></span>
<span class='r-in'><span class='va'>y</span> <span class='op'>&lt;-</span> <span class='va'>sentencing</span><span class='op'>$</span><span class='va'>sents</span></span>
<span class='r-in'><span class='fu'><a href='https://mc-stan.org/bayesplot/reference/PPC-distributions.html'>ppc_dens_overlay</a></span><span class='op'>(</span><span class='va'>y</span>, <span class='va'>yrep</span><span class='op'>)</span></span>
<span class='r-in'><span class='op'>}</span></span>
</code></pre></div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p><p>Developed by Connor Donegan.</p></p>
</div>

<div class="pkgdown">
  <p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 1.6.1.9001.</p></p>
</div>

      </footer>
   </div>

  


  

  </body>
</html>


