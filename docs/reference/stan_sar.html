<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Simultaneous autoregressive (SAR) models — stan_sar • geostan</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/sandstone/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Simultaneous autoregressive (SAR) models — stan_sar"><meta property="og:description" content="Fit data to an spatial Gaussian SAR (spatial error) model, or model a vector of spatially-autocorrelated parameters using a SAR prior model."><meta property="og:image" content="https://connordonegan.github.io/geostan/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-116873024-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-116873024-1');
</script></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">geostan</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.4.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/ConnorDonegan/geostan/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Simultaneous autoregressive (SAR) models</h1>
    <small class="dont-index">Source: <a href="https://github.com/ConnorDonegan/geostan/blob/HEAD/R/stan_sar.R" class="external-link"><code>R/stan_sar.R</code></a></small>
    <div class="hidden name"><code>stan_sar.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Fit data to an spatial Gaussian SAR (spatial error) model, or model a vector of spatially-autocorrelated parameters using a SAR prior model.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">stan_sar</span><span class="op">(</span>
  <span class="va">formula</span>,
  <span class="va">slx</span>,
  <span class="va">re</span>,
  <span class="va">data</span>,
  <span class="va">C</span>,
  sar_parts <span class="op">=</span> <span class="fu"><a href="prep_sar_data.html">prep_sar_data</a></span><span class="op">(</span><span class="va">C</span><span class="op">)</span>,
  family <span class="op">=</span> <span class="fu"><a href="auto_gaussian.html">auto_gaussian</a></span><span class="op">(</span><span class="op">)</span>,
  prior <span class="op">=</span> <span class="cn">NULL</span>,
  ME <span class="op">=</span> <span class="cn">NULL</span>,
  centerx <span class="op">=</span> <span class="cn">FALSE</span>,
  prior_only <span class="op">=</span> <span class="cn">FALSE</span>,
  <span class="va">censor_point</span>,
  chains <span class="op">=</span> <span class="fl">4</span>,
  iter <span class="op">=</span> <span class="fl">2000</span>,
  refresh <span class="op">=</span> <span class="fl">500</span>,
  keep_all <span class="op">=</span> <span class="cn">FALSE</span>,
  pars <span class="op">=</span> <span class="cn">NULL</span>,
  control <span class="op">=</span> <span class="cn">NULL</span>,
  <span class="va">...</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div id="source">
    <h2>Source</h2>
    <p>Cliff, A D and Ord, J K (1981). <em>Spatial Processes: Models and Applications</em>. Pion.</p>
<p>Cressie, Noel (2015 (1993)). <em>Statistics for Spatial Data</em>. Wiley Classics, Revised Edition.</p>
<p>Cressie, Noel and Wikle, Christopher (2011). <em>Statistics for Spatio-Temporal Data</em>. Wiley.</p>
<p>LeSage, James (2014). What Regional Scientists Need to Know about Spatial Econometrics. <em>The Review of Regional Science</em> 44: 13-32 (2014 Southern Regional Science Association Fellows Address).</p>
<p>LeSage, James, &amp; Pace, Robert Kelley (2009). <em>Introduction to Spatial Econometrics</em>. Chapman and Hall/CRC.</p>
    </div>
    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>formula</dt>
<dd><p>A model formula, following the R <code><a href="https://rdrr.io/r/stats/formula.html" class="external-link">formula</a></code> syntax. Binomial models can be specified by setting the left hand side of the equation to a data frame of successes and failures, as in <code>cbind(successes, failures) ~ x</code>.</p></dd>
<dt>slx</dt>
<dd><p>Formula to specify any spatially-lagged covariates. As in, <code>~ x1 + x2</code> (the intercept term will be removed internally). When setting priors for <code>beta</code>, remember to include priors for any SLX terms.</p></dd>
<dt>re</dt>
<dd><p>To include a varying intercept (or "random effects") term, <code>alpha_re</code>, specify the grouping variable here using formula syntax, as in <code>~ ID</code>. Then, <code>alpha_re</code> is a vector of parameters added to the linear predictor of the model, and:</p><div class="sourceCode"><pre><code>alpha_re ~ N(0, alpha_tau)
alpha_tau ~ Student_t(d.f., location, scale).
</code></pre></div>

<p>With the SAR model, any <code>alpha_re</code> term should be at a <em>different</em> level or scale than the observations; that is, at a different scale than the autocorrelation structure of the SAR model itself.</p></dd>
<dt>data</dt>
<dd><p>A <code>data.frame</code> or an object coercible to a data frame by <code>as.data.frame</code> containing the model data.</p></dd>
<dt>C</dt>
<dd><p>Spatial weights matrix (conventionally referred to as \(W\) in the SAR model). Typically, this will be created using <code>geostan::shape2mat(shape, style = "W")</code>. This will be passed internally to <code><a href="prep_sar_data.html">prep_sar_data</a></code>, and will also be used to calculate residual spatial autocorrelation as well as any user specified <code>slx</code> terms; it will automatically be row-standardized before calculating <code>slx</code> terms. See <code><a href="shape2mat.html">shape2mat</a></code>.</p></dd>
<dt>sar_parts</dt>
<dd><p>Optional. If not provided, then <code><a href="prep_sar_data.html">prep_sar_data</a></code> will be used automatically to create <code>sar_parts</code> using the user-provided spatial weights matrix.</p></dd>
<dt>family</dt>
<dd><p>The likelihood function for the outcome variable. Current options are <code><a href="auto_gaussian.html">auto_gaussian()</a></code>, <code>binomial(link = "logit")</code>, and <code>poisson(link = "log")</code>; if <code>family = gaussian()</code> is provided, it will automatically be converted to <code><a href="auto_gaussian.html">auto_gaussian()</a></code>.</p></dd>
<dt>prior</dt>
<dd><p>A named list of parameters for prior distributions (see <code><a href="priors.html">priors</a></code>):</p><dl><dt>intercept</dt>
<dd><p>The intercept is assigned a Gaussian prior distribution (see <code><a href="priors.html">normal</a></code></p></dd>
.

<dt>beta</dt>
<dd><p>Regression coefficients are assigned Gaussian prior distributions. Variables must follow their order of appearance in the model <code>formula</code>. Note that if you also use <code>slx</code> terms (spatially lagged covariates), and you use custom priors for <code>beta</code>, then you have to provide priors for the slx terms. Since slx terms are <em>prepended</em> to the design matrix, the prior for the slx term will be listed first.</p></dd>


<dt>sar_scale</dt>
<dd><p>Scale parameter for the SAR model, <code>sar_scale</code>. The scale is assigned a Student's t prior model (constrained to be positive).</p></dd>


<dt>sar_rho</dt>
<dd><p>The spatial autocorrelation parameter in the SAR model, <code>rho</code>, is assigned a uniform prior distribution. By default, the prior will be uniform over all permissible values as determined by the eigenvalues of the spatial weights matrix. The range of permissible values for <code>rho</code> is printed to the console by <code><a href="prep_sar_data.html">prep_sar_data</a></code>.</p></dd>


<dt>tau</dt>
<dd><p>The scale parameter for any varying intercepts (a.k.a exchangeable random effects, or partial pooling) terms. This scale parameter, <code>tau</code>, is assigned a Student's t prior (constrained to be positive).</p></dd>



</dl></dd>
<dt>ME</dt>
<dd><p>To model observational uncertainty (i.e. measurement or sampling error) in any or all of the covariates, provide a list of data as constructed by the <code><a href="prep_me_data.html">prep_me_data</a></code> function.</p></dd>
<dt>centerx</dt>
<dd><p>To center predictors on their mean values, use <code>centerx = TRUE</code>. If the ME argument is used, the modeled covariate (i.e., latent variable), rather than the raw observations, will be centered. When using the ME argument, this is the recommended method for centering the covariates.</p></dd>
<dt>prior_only</dt>
<dd><p>Logical value; if <code>TRUE</code>, draw samples only from the prior distributions of parameters.</p></dd>
<dt>censor_point</dt>
<dd><p>Integer value indicating the maximum censored value; this argument is for modeling censored (suppressed) outcome data, typically disease case counts or deaths.</p></dd>
<dt>chains</dt>
<dd><p>Number of MCMC chains to use.</p></dd>
<dt>iter</dt>
<dd><p>Number of samples per chain.</p></dd>
<dt>refresh</dt>
<dd><p>Stan will print the progress of the sampler every <code>refresh</code> number of samples. Set <code>refresh=0</code> to silence this.</p></dd>
<dt>keep_all</dt>
<dd><p>If <code>keep_all = TRUE</code> then samples for all parameters in the Stan model will be kept; this is necessary if you want to do model comparison with Bayes factors and the <code>bridgesampling</code> package.</p></dd>
<dt>pars</dt>
<dd><p>Optional; specify any additional parameters you'd like stored from the Stan model.</p></dd>
<dt>control</dt>
<dd><p>A named list of parameters to control the sampler's behavior. See <code><a href="https://mc-stan.org/rstan/reference/stan.html" class="external-link">stan</a></code> for details.</p></dd>
<dt>...</dt>
<dd><p>Other arguments passed to <code><a href="https://mc-stan.org/rstan/reference/stanmodel-method-sampling.html" class="external-link">sampling</a></code>. For multi-core processing, you can use <code>cores = parallel::detectCores()</code>, or run <code>options(mc.cores = parallel::detectCores())</code> first.</p></dd>
</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>An object of class class <code>geostan_fit</code> (a list) containing:</p><dl><dt>summary</dt>
<dd><p>Summaries of the main parameters of interest; a data frame.</p></dd>

<dt>diagnostic</dt>
<dd><p>Widely Applicable Information Criteria (WAIC) with a measure of effective number of parameters (<code>eff_pars</code>) and mean log pointwise predictive density (<code>lpd</code>), and mean residual spatial autocorrelation as measured by the Moran coefficient.</p></dd>

<dt>stanfit</dt>
<dd><p>an object of class <code>stanfit</code> returned by <code><a href="https://mc-stan.org/rstan/reference/stan.html" class="external-link">rstan::stan</a></code></p></dd>

<dt>data</dt>
<dd><p>a data frame containing the model data</p></dd>

<dt>family</dt>
<dd><p>the user-provided or default <code>family</code> argument used to fit the model</p></dd>

<dt>formula</dt>
<dd><p>The model formula provided by the user (not including CAR component)</p></dd>

<dt>slx</dt>
<dd><p>The <code>slx</code> formula</p></dd>

<dt>re</dt>
<dd><p>A list containing <code>re</code>, the varying intercepts (<code>re</code>) formula if provided, and
<code>Data</code> a data frame with columns <code>id</code>, the grouping variable, and <code>idx</code>, the index values assigned to each group.</p></dd>

<dt>priors</dt>
<dd><p>Prior specifications.</p></dd>


<dt>x_center</dt>
<dd><p>If covariates are centered internally (<code>centerx = TRUE</code>), then <code>x_center</code> is a numeric vector of the values on which covariates were centered.</p></dd>


<dt>spatial</dt>
<dd><p>A data frame with the name of the spatial component parameter (either "phi" or, for auto Gaussian models, "trend") and method ("SAR")</p></dd>

<dt>ME</dt>
<dd><p>A list indicating if the object contains an ME model; if so, the user-provided ME list is also stored here.</p></dd>

<dt>C</dt>
<dd><p>Spatial weights matrix (in sparse matrix format).</p></dd>


</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>Discussions of SAR models may be found in Cliff and Ord (1981), Cressie (2015, Ch. 6), LeSage and Pace (2009), and LeSage (2014).</p>
<p>The general scheme of the SAR model for numeric vector \(y\) is
$$
 y = \mu + ( I - \rho W)^{-1} \epsilon \\
\epsilon \sim Gauss(0, \sigma^2 I)
$$
where \(W\) is the spatial weights matrix, \(I\) is the n-by-n identity matrix, and \(\rho\) is a spatial autocorrelation parameter. In words, the errors of the regression equation are spatially autocorrelated.</p>
<p>Re-arranging terms, the model can also be written as follows:
$$
 y = \mu + \rho W (y - \mu)  + \epsilon
$$
which perhaps shows more intuitively the implicit spatial trend component, \(\rho W (y - \mu)\).</p>
<p>Most often, this model is applied directly to observations (referred to below as the auto-Gaussian model). The SAR model can also be applied to a vector of parameters inside a hierarchical model. The latter enables spatial autocorrelation to be modeled when the observations are discrete counts (e.g., disease incidence data).</p>
<p>A note on terminology: the spatial statistics literature conceptualizes the simultaneously-specified spatial autoregressive model (SAR) in relation to the conditionally-specified spatial autoregressive model (CAR) (see <a href="stan_car.html">stan_car</a>) (see Cliff and Ord 1981). The spatial econometrics literature, by contrast, refers to the simultaneously-specified spatial autoregressive (SAR) model as the spatial error model (SEM), and they contrast the SEM with the spatial lag model (which contains a spatially-lagged dependent variable on the right-hand-side of the regression equation) (see LeSage 2014).</p><div class="section">
<h3 id="auto-gaussian">Auto-Gaussian<a class="anchor" aria-label="anchor" href="#auto-gaussian"></a></h3>


<p>When <code>family = auto_gaussian()</code>, the SAR model is specified as follows:
$$
y \sim Gauss(\mu, \Sigma) \\
\Sigma = \sigma^2 (I - \rho W)^{-1}(I - \rho W')^{-1}
$$
where \(\mu\) is the mean vector (with intercept, covariates, etc.), \(W\) is a spatial weights matrix (usually row-standardized), and \(\sigma\) is a scale parameter.</p>
<p>The SAR model contains an implicit spatial trend (i.e., spatial autocorrelation) component \(\phi\) which is calculated as follows:
$$
\phi = \rho W (y - \mu)
$$</p>
<p>This term can be extracted from a fitted auto-Gaussian model using the <a href="geostan_fit.html">spatial</a> method.</p>
<p>When applied to a fitted auto-Gaussian model, the <a href="geostan_fit.html">residuals.geostan_fit</a> method returns 'de-trended' residuals \(R\) by default. That is,
$$
R = y - \mu - \rho W (y - \mu).
$$
To obtain "raw" residuals (\(y - \mu\)), use <code>residuals(fit, detrend = FALSE)</code>. Similarly, the fitted values obtained from the <a href="geostan_fit.html">fitted.geostan_fit</a> will include the spatial trend term by default.</p>
</div>

<div class="section">
<h3 id="poisson">Poisson<a class="anchor" aria-label="anchor" href="#poisson"></a></h3>


<p>For <code>family = poisson()</code>, the model is specified as:</p>
<p>$$
y \sim Poisson(e^{O + \lambda}) \\
\lambda \sim Gauss(\mu, \Sigma)   \\
\Sigma = \sigma^2 (I - \rho W)^{-1}(I - \rho W')^{-1}.
$$
If the raw outcome consists of a rate \(\frac{y}{p}\) with observed counts \(y\) and denominator p (often this will be the size of the population at risk), then the offset term \(O=log(p)\) is the log of the denominator.</p>
<p>This is often written (equivalently) as:
$$
y \sim Poisson(e^{O + \mu + \phi}) \\
\phi \sim Gauss(0, \Sigma) \\
\Sigma = \sigma^2 (I - \rho W)^{-1}(I - \rho W')^{-1}
$$</p>
<p>For Poisson models, the <a href="geostan_fit.html">spatial</a> method returns the parameter vector \(\phi\).</p>
<p>In the Poisson SAR model, \(\phi\) contains a latent spatial trend as well as additional variation around it. If you would like to extract the latent/implicit spatial trend from \(\phi\), you can do so by calculating:
$$
 \rho W \phi.
$$</p>
</div>

<div class="section">
<h3 id="binomial">Binomial<a class="anchor" aria-label="anchor" href="#binomial"></a></h3>


<p>For <code>family = binomial()</code>, the model is specified as:
$$
y \sim Binomial(N, \lambda)  \\
logit(\lambda) \sim Gauss(\mu, \Sigma)  \\
\Sigma = \sigma^2 (I - \rho W)^{-1}(I - \rho W')^{-1}
$$
where outcome data \(y\) are counts, \(N\) is the number of trials, and \(\lambda\) is the rate of 'success'. Note that the model formula should be structured as: <code>cbind(sucesses, failures) ~ 1</code> (for an intercept-only model), such that <code>trials = successes + failures</code>.</p>
<p>For fitted Binomial models, the <code><a href="geostan_fit.html">spatial</a></code> method will return the parameter vector <code>phi</code>, equivalent to:
$$
\phi = logit(\lambda) - \mu.
$$
As is also the case for the Poisson model, \(\phi\) contains a latent spatial trend as well as additional variation around it. If you would like to extract the latent/implicit spatial trend from \(\phi\), you can do so by calculating:
$$
\rho W \phi.
$$</p>
</div>

<div class="section">
<h3 id="spatially-lagged-covariates-slx-">Spatially lagged covariates (SLX)<a class="anchor" aria-label="anchor" href="#spatially-lagged-covariates-slx-"></a></h3>


<p>The <code>slx</code> argument is a convenience function for including SLX terms. For example,
$$
 y = W X \gamma + X \beta + \epsilon
$$
where \(W\) is a row-standardized spatial weights matrix (see <a href="shape2mat.html">shape2mat</a>), \(WX\) is the mean neighboring value of \(X\), and \(\gamma\) is a coefficient vector. This specifies a regression with spatially lagged covariates. SLX terms can specified by providing a formula to the <code>slx</code> argument:</p><div class="sourceCode"><pre><code>stan_glm(y ~ x1 + x2, slx = ~ x1 + x2, \...),
</code></pre></div>

<p>which is a shortcut for</p><div class="sourceCode"><pre><code>stan_glm(y ~ I(W \%*\% x1) + I(W \%*\% x2) + x1 + x2, \...)
</code></pre></div>

<p>SLX terms will always be <em>prepended</em> to the design matrix, as above, which is important to know when setting prior distributions for regression coefficients.</p>
<p>For measurement error (ME) models, the SLX argument is the only way to include spatially lagged covariates since the SLX term needs to be re-calculated on each iteration of the MCMC algorithm.</p>
</div>

<div class="section">
<h3 id="measurement-error-me-models">Measurement error (ME) models<a class="anchor" aria-label="anchor" href="#measurement-error-me-models"></a></h3>


<p>The ME models are designed for surveys with spatial sampling designs, such as the American Community Survey (ACS) estimates. Given estimates \(x\), their standard errors \(s\), and the target quantity of interest (i.e., the unknown true value) \(z\), the ME models have one of the the following two specifications, depending on the user input. If a spatial CAR model is specified, then:
$$
 x \sim Gauss(z, s^2) \\
 z \sim Gauss(\mu_z, \Sigma_z) \\
\Sigma_z = (I - \rho C)^{-1} M \\
 \mu_z \sim Gauss(0, 100) \\
 \tau_z \sim Student-t(10, 0, 40), \tau &gt; 0 \\
 \rho_z \sim uniform(l, u)
 $$
where \(\Sigma\) specifies a spatial conditional autoregressive model with scale parameter \(\tau\) (on the diagonal of \(M\)), and \(l\), \(u\) are the lower and upper bounds that \(\rho\) is permitted to take (which is determined by the extreme eigenvalues of the spatial connectivity matrix \(C\)).</p>
<p>For non-spatial ME models, the following is used instead:
$$
x \sim Gauss(z, s^2) \\
z \sim student_t(\nu_z, \mu_z, \sigma_z) \\
\nu_z \sim gamma(3, 0.2) \\
\mu_z \sim Gauss(0, 100) \\
\sigma_z \sim student-t(10, 0, 40).
$$</p>
<p>For strongly skewed variables, such as census tract poverty rates, it can be advantageous to apply a logit transformation to \(z\) before applying the CAR or Student-t prior model. When the <code>logit</code> argument is used, the model becomes:
$$
x \sim Gauss(z, s^2) \\
logit(z) \sim Gauss(\mu_z, \Sigma_z) 
...
$$
and similarly for the Student t model:
$$
x \sim Gauss(z, s^2) \\
logit(z) \sim student-t(\nu_z, \mu_z, \sigma_z) \\
...
$$</p>
</div>

<div class="section">
<h3 id="censored-counts">Censored counts<a class="anchor" aria-label="anchor" href="#censored-counts"></a></h3>


<p>Vital statistics systems and disease surveillance programs typically suppress case counts when they are smaller than a specific threshold value. In such cases, the observation of a censored count is not the same as a missing value; instead, you are informed that the value is an integer somewhere between zero and the threshold value. For Poisson models (<code>family = poisson())</code>), you can use the <code>censor_point</code> argument to encode this information into your model.</p>
<p>Internally, <code>geostan</code> will keep the index values of each censored observation, and the index value of each of the fully observed outcome values. For all observed counts, the likelihood statement will be:
$$
p(y_i | data, model) = poisson(y_i | \mu_i), 
$$
as usual, where \(\mu_i\) may include whatever spatial terms are present in the model.</p>
<p>For each censored count, the likelihood statement will equal the cumulative Poisson distribution function for values zero through the censor point:
$$
p(y_i | data, model) = \sum_{m=0}^{M} Poisson( m | \mu_i),
$$
where \(M\) is the censor point and \(\mu_i\) again is the fitted value for the \(i^{th}\) observation.</p>
<p>For example, the US Centers for Disease Control and Prevention's CDC WONDER database censors all death counts between 0 and 9. To model CDC WONDER mortality data, you could provide <code>censor_point = 9</code> and then the likelihood statement for censored counts would equal the summation of the Poisson probability mass function over each integer ranging from zero through 9 (inclusive), conditional on the fitted values (i.e., all model parameters). See Donegan (2021) for additional discussion, references, and Stan code.</p>
</div>

    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Connor Donegan, <a href="mailto:connor.donegan@gmail.com">connor.donegan@gmail.com</a></p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="co"># model mortality risk</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">georgia</span><span class="op">)</span>
<span class="va">W</span> <span class="op">&lt;-</span> <span class="fu"><a href="shape2mat.html">shape2mat</a></span><span class="op">(</span><span class="va">georgia</span>, style <span class="op">=</span> <span class="st">"W"</span><span class="op">)</span>

<span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">stan_sar</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">rate.male</span><span class="op">)</span> <span class="op">~</span> <span class="fl">1</span>,
                C <span class="op">=</span> <span class="va">W</span>,
                data <span class="op">=</span> <span class="va">georgia</span>,
                chains <span class="op">=</span> <span class="fl">1</span>, <span class="co"># for ex. speed only</span>
                iter <span class="op">=</span> <span class="fl">700</span> 
                <span class="op">)</span>

<span class="fu">rstan</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/rstan/reference/stan_plot_diagnostics.html" class="external-link">stan_rhat</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">stanfit</span><span class="op">)</span>
<span class="fu">rstan</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/rstan/reference/stan_plot_diagnostics.html" class="external-link">stan_mcse</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">stanfit</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span>
<span class="fu"><a href="sp_diag.html">sp_diag</a></span><span class="op">(</span><span class="va">fit</span>, <span class="va">georgia</span><span class="op">)</span>

<span class="co"># \donttest{</span>
 <span class="co"># a more appropriate model for count data:</span>
<span class="va">fit2</span> <span class="op">&lt;-</span> <span class="fu">stan_sar</span><span class="op">(</span><span class="va">deaths.male</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/offset.html" class="external-link">offset</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">pop.at.risk.male</span><span class="op">)</span><span class="op">)</span>,
                C <span class="op">=</span> <span class="va">W</span>,
                data <span class="op">=</span> <span class="va">georgia</span>,
                family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">poisson</a></span><span class="op">(</span><span class="op">)</span>,
                chains <span class="op">=</span> <span class="fl">1</span>, <span class="co"># for ex. speed only</span>
                iter <span class="op">=</span> <span class="fl">700</span> 
                 <span class="op">)</span>
<span class="fu"><a href="sp_diag.html">sp_diag</a></span><span class="op">(</span><span class="va">fit2</span>, <span class="va">georgia</span><span class="op">)</span>
<span class="co"># }</span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Connor Donegan.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

      </footer></div>

  


  

  </body></html>

