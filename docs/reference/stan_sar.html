<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Simultaneous autoregressive (SAR) models — stan_sar • geostan</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/united/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Simultaneous autoregressive (SAR) models — stan_sar"><meta property="og:description" content="Fit data to a simultaneous spatial autoregressive (SAR) model, or use the SAR model as the prior model for a parameter vector in a hierarchical model."><meta property="og:image" content="https://connordonegan.github.io/geostan/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">geostan</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.7.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/ConnorDonegan/geostan/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Simultaneous autoregressive (SAR) models</h1>
    <small class="dont-index">Source: <a href="https://github.com/ConnorDonegan/geostan/blob/HEAD/R/stan_sar.R" class="external-link"><code>R/stan_sar.R</code></a></small>
    <div class="hidden name"><code>stan_sar.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Fit data to a simultaneous spatial autoregressive (SAR) model, or use the SAR model as the prior model for a parameter vector in a hierarchical model.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">stan_sar</span><span class="op">(</span></span>
<span>  <span class="va">formula</span>,</span>
<span>  <span class="va">slx</span>,</span>
<span>  <span class="va">re</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">C</span>,</span>
<span>  sar_parts <span class="op">=</span> <span class="fu"><a href="prep_sar_data.html">prep_sar_data</a></span><span class="op">(</span><span class="va">C</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="auto_gaussian.html">auto_gaussian</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SEM"</span>, <span class="st">"SDEM"</span>, <span class="st">"SDLM"</span>, <span class="st">"SLM"</span><span class="op">)</span>,</span>
<span>  prior <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ME <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  centerx <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  prior_only <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">censor_point</span>,</span>
<span>  chains <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  iter <span class="op">=</span> <span class="fl">2000</span>,</span>
<span>  refresh <span class="op">=</span> <span class="fl">500</span>,</span>
<span>  keep_all <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  pars <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  slim <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  drop <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  control <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="source">
    <h2>Source</h2>
    <p>Cliff, A D and Ord, J K (1981). <em>Spatial Processes: Models and Applications</em>. Pion.</p>
<p>Cressie, Noel (2015 (1993)). <em>Statistics for Spatial Data</em>. Wiley Classics, Revised Edition.</p>
<p>Cressie, Noel and Wikle, Christopher (2011). <em>Statistics for Spatio-Temporal Data</em>. Wiley.</p>
<p>Donegan, Connor (2021). Building spatial conditional autoregressive (CAR) models in the Stan programming language. <em>OSF Preprints</em>. <a href="https://doi.org/10.31219/osf.io/3ey65" class="external-link">doi:10.31219/osf.io/3ey65</a>
.</p>
<p>LeSage, James (2014). What Regional Scientists Need to Know about Spatial Econometrics. <em>The Review of Regional Science</em> 44: 13-32 (2014 Southern Regional Science Association Fellows Address).</p>
<p>LeSage, James, &amp; Pace, Robert Kelley (2009). <em>Introduction to Spatial Econometrics</em>. Chapman and Hall/CRC.</p>
    </div>
    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>formula</dt>
<dd><p>A model formula, following the R <code><a href="https://rdrr.io/r/stats/formula.html" class="external-link">formula</a></code> syntax. Binomial models can be specified by setting the left hand side of the equation to a data frame of successes and failures, as in <code>cbind(successes, failures) ~ x</code>.</p></dd>


<dt>slx</dt>
<dd><p>Formula to specify any spatially-lagged covariates. As in, <code>~ x1 + x2</code> (the intercept term will be removed internally). When setting priors for <code>beta</code>, remember to include priors for any SLX terms.</p></dd>


<dt>re</dt>
<dd><p>To include a varying intercept (or "random effects") term, <code>alpha_re</code>, specify the grouping variable here using formula syntax, as in <code>~ ID</code>. Then, <code>alpha_re</code> is a vector of parameters added to the linear predictor of the model, and:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a>alpha_re <span class="op">~</span><span class="st"> </span><span class="kw">N</span>(<span class="dv">0</span>, alpha_tau)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a>alpha_tau <span class="op">~</span><span class="st"> </span><span class="kw">Student_t</span>(d.f., location, scale).</span></code></pre><p></p></div>
<p>With the SAR model, any <code>alpha_re</code> term should be at a <em>different</em> level or scale than the observations; that is, at a different scale than the autocorrelation structure of the SAR model itself.</p></dd>


<dt>data</dt>
<dd><p>A <code>data.frame</code> or an object coercible to a data frame by <code>as.data.frame</code> containing the model data.</p></dd>


<dt>C</dt>
<dd><p>Spatial weights matrix (conventionally referred to as \(W\) in the SAR model). Typically, this will be created using <code>geostan::shape2mat(shape, style = "W")</code>. This will be passed internally to <code><a href="prep_sar_data.html">prep_sar_data</a></code>, and will also be used to calculate residual spatial autocorrelation as well as any user specified <code>slx</code> terms. See <code><a href="shape2mat.html">shape2mat</a></code>.</p></dd>


<dt>sar_parts</dt>
<dd><p>List of data constructed by <code><a href="prep_sar_data.html">prep_sar_data</a></code>. If not provided, then <code>C</code> will automatically be passed to <code><a href="prep_sar_data.html">prep_sar_data</a></code> to create <code>sar_parts</code>.</p></dd>


<dt>family</dt>
<dd><p>The likelihood function for the outcome variable. Current options are <code><a href="auto_gaussian.html">auto_gaussian()</a></code>, <code><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial()</a></code> (with logit link function) and <code><a href="https://rdrr.io/r/stats/family.html" class="external-link">poisson()</a></code> (with log link function); if <code>family = gaussian()</code> is provided, it will automatically be converted to <code><a href="auto_gaussian.html">auto_gaussian()</a></code>.</p></dd>


<dt>type</dt>
<dd><p>Type of SAR model (character string): spatial error model ('SEM'), spatial Durbin error model ('SDEM'), spatial Durbin lag model ('SDLM'), or spatial lag model ('SLM'). see Details below.</p></dd>


<dt>prior</dt>
<dd><p>A named list of parameters for prior distributions (see <code><a href="priors.html">priors</a></code>):</p><dl><dt>intercept</dt>
<dd><p>The intercept is assigned a Gaussian prior distribution (see <code><a href="priors.html">normal</a></code></p></dd>
.

<dt>beta</dt>
<dd><p>Regression coefficients are assigned Gaussian prior distributions. Variables must follow their order of appearance in the model <code>formula</code>. Note that if you also use <code>slx</code> terms (spatially lagged covariates), and you use custom priors for <code>beta</code>, then you have to provide priors for the slx terms. Since slx terms are <em>prepended</em> to the design matrix, the prior for the slx term will be listed first.</p></dd>


<dt>sar_scale</dt>
<dd><p>Scale parameter for the SAR model, <code>sar_scale</code>. The scale is assigned a Student's t prior model (constrained to be positive).</p></dd>


<dt>sar_rho</dt>
<dd><p>The spatial autocorrelation parameter in the SAR model, <code>rho</code>, is assigned a uniform prior distribution. By default, the prior will be uniform over all permissible values as determined by the eigenvalues of the spatial weights matrix. The range of permissible values for <code>rho</code> is printed to the console by <code><a href="prep_sar_data.html">prep_sar_data</a></code>.</p></dd>


<dt>tau</dt>
<dd><p>The scale parameter for any varying intercepts (a.k.a exchangeable random effects, or partial pooling) terms. This scale parameter, <code>tau</code>, is assigned a Student's t prior (constrained to be positive).</p></dd>



</dl></dd>


<dt>ME</dt>
<dd><p>To model observational uncertainty in any or all of the covariates (i.e. measurement or sampling error), provide a list of data constructed by the <code><a href="prep_me_data.html">prep_me_data</a></code> function.</p></dd>


<dt>centerx</dt>
<dd><p>To center predictors on their mean values, use <code>centerx = TRUE</code>. This increases sampling speed. If the ME argument is used, the modeled covariate (i.e., the latent variable), rather than the raw observations, will be centered.</p></dd>


<dt>prior_only</dt>
<dd><p>Logical value; if <code>TRUE</code>, draw samples only from the prior distributions of parameters.</p></dd>


<dt>censor_point</dt>
<dd><p>Integer value indicating the maximum censored value; this argument is for modeling censored (suppressed) outcome data, typically disease case counts or deaths which are left-censored to protect confidentiality when case counts are very low.</p></dd>


<dt>chains</dt>
<dd><p>Number of MCMC chains to use.</p></dd>


<dt>iter</dt>
<dd><p>Number of MCMC samples per chain.</p></dd>


<dt>refresh</dt>
<dd><p>Stan will print the progress of the sampler every <code>refresh</code> number of samples. Set <code>refresh=0</code> to silence this.</p></dd>


<dt>keep_all</dt>
<dd><p>If <code>keep_all = TRUE</code> then samples for all parameters in the Stan model will be kept; this is necessary if you want to do model comparison with Bayes factors using the <code>bridgesampling</code> package.</p></dd>


<dt>pars</dt>
<dd><p>Specify any additional parameters you'd like stored from the Stan model.</p></dd>


<dt>slim</dt>
<dd><p>If <code>slim = TRUE</code>, then the Stan model will not save the most memory-intensive parameters (including n-length vectors of fitted values, other 'random effects', and ME-modeled covariate values). This will disable some convenience functions that are otherwise available for fitted <code>geostan</code> models, such as the extraction of residuals, fitted values, and spatial trends, spatial diagnostics, and ME diagnostics. The "slim" option is designed for data-intensive routines, such as regression with raster data, Monte Carlo studies, and measurement error models.</p></dd>


<dt>drop</dt>
<dd><p>Provide a vector of character strings to specify the names of any parameters that you do not want MCMC samples for. Dropping parameters in this way can improve sampling speed and reduce memory usage. The following parameter vectors can potentially be dropped from SAR models:</p><dl><dt>fitted</dt>
<dd><p>The N-length vector of fitted values</p></dd>

<dt>alpha_re</dt>
<dd><p>Vector of 'random effects'/varying intercepts.</p></dd>

<dt>log_lambda_mu</dt>
<dd><p>Linear predictor inside the SAR model (for Poisson and binomial models)</p></dd>

<dt>x_true</dt>
<dd><p>N-length vector of 'latent'/modeled covariate values created for measurement error (ME) models.</p></dd>


</dl><p>Using <code>drop = c('fitted', 'alpha_re', 'x_true', 'log_lambda_mu')</code> is equivalent to <code>slim = TRUE</code>. Note that if <code>slim = TRUE</code>, then <code>drop</code> will be ignored---so only use one or the other.</p></dd>


<dt>control</dt>
<dd><p>A named list of parameters to control the sampler's behavior. See <code><a href="https://mc-stan.org/rstan/reference/stan.html" class="external-link">stan</a></code> for details.</p></dd>


<dt>quiet</dt>
<dd><p>Controls (most) automatic printing to the console. By default, any prior distributions that have not been assigned by the user are printed to the console; if <code>quiet = TRUE</code>, these will not be printed. Using <code>quiet = TRUE</code> will also force <code>refresh = 0</code>.</p></dd>


<dt>...</dt>
<dd><p>Other arguments passed to <code><a href="https://mc-stan.org/rstan/reference/stanmodel-method-sampling.html" class="external-link">sampling</a></code>.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>An object of class class <code>geostan_fit</code> (a list) containing:</p><dl><dt>summary</dt>
<dd><p>Summaries of the main parameters of interest; a data frame.</p></dd>

<dt>diagnostic</dt>
<dd><p>Residual spatial autocorrelation as measured by the Moran coefficient.</p></dd>

<dt>stanfit</dt>
<dd><p>an object of class <code>stanfit</code> returned by <code><a href="https://mc-stan.org/rstan/reference/stan.html" class="external-link">rstan::stan</a></code></p></dd>

<dt>data</dt>
<dd><p>a data frame containing the model data</p></dd>

<dt>family</dt>
<dd><p>the user-provided or default <code>family</code> argument used to fit the model</p></dd>

<dt>formula</dt>
<dd><p>The model formula provided by the user (not including CAR component)</p></dd>

<dt>slx</dt>
<dd><p>The <code>slx</code> formula</p></dd>

<dt>re</dt>
<dd><p>A list containing <code>re</code>, the varying intercepts (<code>re</code>) formula if provided, and
<code>Data</code> a data frame with columns <code>id</code>, the grouping variable, and <code>idx</code>, the index values assigned to each group.</p></dd>

<dt>priors</dt>
<dd><p>Prior specifications.</p></dd>


<dt>x_center</dt>
<dd><p>If covariates are centered internally (<code>centerx = TRUE</code>), then <code>x_center</code> is a numeric vector of the values on which covariates were centered.</p></dd>


<dt>spatial</dt>
<dd><p>A data frame with the name of the spatial component parameter (either "phi" or, for auto Gaussian models, "trend") and method ("SAR")</p></dd>

<dt>ME</dt>
<dd><p>A list indicating if the object contains an ME model; if so, the user-provided ME list is also stored here.</p></dd>

<dt>C</dt>
<dd><p>Spatial weights matrix (in sparse matrix format).</p></dd>

<dt>sar_type</dt>
<dd><p>Type of SAR model: 'SEM', 'SDEM', 'SDLM', or 'SLM'.</p></dd>


</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>Discussions of SAR models may be found in Cliff and Ord (1981), Cressie (2015, Ch. 6), LeSage and Pace (2009), and LeSage (2014). The Stan implementation draws from Donegan (2021).</p>
<p>There are two SAR specification options which are commonly known as the spatial error ('SEM') and the spatial lag ('SLM') models. When the spatial-lag of the covariates are included, then the model is referred to as a spatial Durbin model; depending on the model type, it becomes a spatial Durbin error model ('SDEM') or a spatial Durbin lag model ('SDLM').</p>
<p>The mathematics and typical interpretation of the SLM/SDLM is unusual and the conventional interpretation of regression coefficients does not apply! Use the <a href="impacts.html">impacts</a> method to interpret results from the SLM and SDLM models (that is, granted that this model form is at least plausible for the application).</p>
<p>Use of the 'SDEM' and 'SDLM' options are for convenience only: you can also obtain the Durbin models using the <code>slx</code> (spatial lag of X) argument. The <code>slx</code> argument allows control over which covariates will be added in spatial-lag form; the Durbin options include the spatial lag of all covariates.</p>
<p>The spatial error specification ('SEM') is
$$y = \mu + ( I - \rho C)^{-1} \epsilon$$
$$\epsilon \sim Gauss(0, \sigma^2)$$
where \(C\) is the spatial connectivity matrix, \(I\) is the n-by-n identity matrix, and \(\rho\) is a spatial autocorrelation parameter. In words, the errors of the regression equation are spatially autocorrelated.</p>
<p>Re-arranging terms, the model can also be written as follows:
$$y = \mu + \rho C (y - \mu)  + \epsilon$$
which perhaps shows more intuitively the implicit spatial trend component, \(\rho C (y - \mu)\).</p>
<p>The second SAR specification type is the 'spatial lag of y' ('SLM'). This model describes a diffusion or contagion process:
$$y = \rho C y + \mu + \epsilon$$
$$\epsilon \sim Gauss(0, \sigma^2)$$
This is attractive for modeling actual contagion processes. Here the 'spatial trend' part is simply \(\rho C y\).</p>
<p>Both model types have a covariance matrix of:</p>
<p>$$\Sigma = \sigma^2 (I - \rho C)^{-1}(I - \rho C')^{-1}.$$</p>
<p>But the expected values of the models differ. The expected value for the SEM is the usual \(\mu\) (the intercept plus <code>X*beta</code>); the expected value of the SLM is \((I - rho C)^{-1} \mu\).</p>
<p>Most often, the SAR model is applied directly to observations (referred to below as the auto-normal or auto-Gaussian model). The SAR model can also be applied to a vector of parameters inside a hierarchical model. The latter enables spatial or network autocorrelation to be modeled when the observations are discrete counts (e.g., hierarchical models for disease incidence rates).</p><div class="section">
<h3 id="auto-normal">Auto-normal<a class="anchor" aria-label="anchor" href="#auto-normal"></a></h3>


<p>When <code>family = auto_gaussian()</code>, the SAR model is specified as follows:</p>
<p>$$y \sim Gauss(\mu, \Sigma)$$
$$\Sigma = \sigma^2 (I - \rho C)^{-1}(I - \rho C')^{-1}$$
where \(\mu\) is the mean vector (with intercept, covariates, etc.), \(C\) is a spatial weights or connectivity matrix (usually row-standardized), and \(\sigma\) is a scale parameter.</p>
<p>The SAR model contains an implicit spatial trend (i.e., spatial autocorrelation) component \(\phi\) which is calculated as follows:
$$
\phi = \rho C (y - \mu)
$$</p>
<p>This term can be extracted from a fitted auto-Gaussian model using the <a href="resid_geostan_fit.html">spatial</a> method.</p>
<p>When applied to a fitted auto-Gaussian model, the <a href="resid_geostan_fit.html">residuals.geostan_fit</a> method returns 'de-trended' residuals \(R\) by default. That is,
$$
R = y - \mu - \rho C (y - \mu).
$$
To obtain "raw" residuals (\(y - \mu\)), use <code>residuals(fit, detrend = FALSE)</code>. Similarly, the fitted values obtained from the <a href="resid_geostan_fit.html">fitted.geostan_fit</a> will include the spatial trend term by default.</p>
</div>

<div class="section">
<h3 id="poisson">Poisson<a class="anchor" aria-label="anchor" href="#poisson"></a></h3>


<p>For <code>family = poisson()</code>, the model is specified as:</p>
<p>$$y \sim Poisson(e^{O + \lambda})$$
$$\lambda \sim Gauss(\mu, \Sigma)$$
$$\Sigma = \sigma^2 (I - \rho C)^{-1}(I - \rho C')^{-1}.$$</p>
<p><code>O</code> is a constant/offset term. If the raw outcome consists of a rate \(\frac{y}{p}\) with observed counts \(y\) and denominator \(p\) (often this will be the size of the population at risk), then the offset term \(O=log(p)\) is the log of the denominator.</p>
<p>This is often written (equivalently) as:</p>
<p>$$y \sim Poisson(e^{O + \mu + \phi})$$
$$ \phi \sim Gauss(0, \Sigma) $$
$$ \Sigma = \sigma^2 (I - \rho C)^{-1}(I - \rho C')^{-1}.$$</p>
<p>For Poisson models, the <a href="resid_geostan_fit.html">spatial</a> method returns the parameter vector \(\phi\).</p>
<p>In the Poisson SAR model, \(\phi\) contains a latent (smooth) spatial trend as well as additional variation around it. If you would like to extract the latent/implicit spatial trend from \(\phi\), you can do so by calculating:
$$
 \rho C \phi.
$$</p>
</div>

<div class="section">
<h3 id="binomial">Binomial<a class="anchor" aria-label="anchor" href="#binomial"></a></h3>


<p>For <code>family = binomial()</code>, the model is specified as:</p>
<p>$$y \sim Binomial(N, \lambda) $$
$$logit(\lambda) \sim Gauss(\mu, \Sigma) $$
$$\Sigma = \sigma^2 (I - \rho C)^{-1}(I - \rho C')^{-1}.$$</p>
<p>where outcome data \(y\) are counts, \(N\) is the number of trials, and \(\lambda\) is the rate of 'success'. Note that the model formula should be structured as: <code>cbind(sucesses, failures) ~ 1</code> (for an intercept-only model), such that <code>trials = successes + failures</code>.</p>
<p>For fitted Binomial models, the <code><a href="resid_geostan_fit.html">spatial</a></code> method will return the parameter vector <code>phi</code>, equivalent to:</p>
<p>$$\phi = logit(\lambda) - \mu.$$</p>
<p>As is also the case for the Poisson model, \(\phi\) contains a latent spatial trend as well as additional variation around it. If you would like to extract the latent/implicit spatial trend from \(\phi\), you can do so by calculating:
$$
\rho C \phi.
$$</p>
</div>

<div class="section">
<h3 id="additional-functionality">Additional functionality<a class="anchor" aria-label="anchor" href="#additional-functionality"></a></h3>


<p>The SAR models can also incorporate spatially-lagged covariates, measurement/sampling error in covariates (particularly when using small area survey estimates as covariates), missing outcome data, and censored outcomes (such as arise when a disease surveillance system suppresses data for privacy reasons). For details on these options, please see the Details section in the documentation for <a href="stan_glm.html">stan_glm</a>.</p>
</div>

    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Connor Donegan, <a href="mailto:connor.donegan@gmail.com">connor.donegan@gmail.com</a></p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">##</span></span></span>
<span class="r-in"><span><span class="co">## simulate SAR data on a regular grid</span></span></span>
<span class="r-in"><span><span class="co">##</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">sars</span> <span class="op">&lt;-</span> <span class="fu"><a href="prep_sar_data2.html">prep_sar_data2</a></span><span class="op">(</span>row <span class="op">=</span> <span class="fl">10</span>, col <span class="op">=</span> <span class="fl">10</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">w</span> <span class="op">&lt;-</span> <span class="va">sars</span><span class="op">$</span><span class="va">W</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># draw x</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="sim_sar.html">sim_sar</a></span><span class="op">(</span>w <span class="op">=</span> <span class="va">w</span>, rho <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># draw y = mu + rho*W*(y - mu) + epsilon</span></span></span>
<span class="r-in"><span><span class="co"># beta = 0.5, rho = 0.5</span></span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="sim_sar.html">sim_sar</a></span><span class="op">(</span>w <span class="op">=</span> <span class="va">w</span>, rho <span class="op">=</span> <span class="fl">.5</span>, mu <span class="op">=</span> <span class="fl">0.5</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">y</span>, x <span class="op">=</span> <span class="va">x</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">##</span></span></span>
<span class="r-in"><span><span class="co">## fit SEM</span></span></span>
<span class="r-in"><span><span class="co">##</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">fit_sem</span> <span class="op">&lt;-</span> <span class="fu">stan_sar</span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, data <span class="op">=</span> <span class="va">dat</span>, sar <span class="op">=</span> <span class="va">sars</span>,</span></span>
<span class="r-in"><span>                    chains <span class="op">=</span> <span class="fl">1</span>, iter <span class="op">=</span> <span class="fl">800</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> *Setting prior parameters for intercept</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Distribution: normal</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   location scale</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1     0.28     5</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> *Setting prior parameters for beta</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Distribution: normal</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   location scale</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1        0     5</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> *Setting prior for SAR scale parameter (sar_scale)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Distribution: student_t</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   df location scale</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 10        0     3</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> *Setting prior for SAR spatial autocorrelation parameter (sar_rho)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Distribution: uniform</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   lower upper</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1    -1     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> SAMPLING FOR MODEL 'foundation' NOW (CHAIN 1).</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: Gradient evaluation took 5.7e-05 seconds</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 0.57 seconds.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: Adjust your expectations accordingly!</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: Iteration:   1 / 800 [  0%]  (Warmup)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: Iteration: 401 / 800 [ 50%]  (Sampling)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: Iteration: 800 / 800 [100%]  (Sampling)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1:  Elapsed Time: 0.087 seconds (Warm-up)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1:                0.069 seconds (Sampling)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1:                0.156 seconds (Total)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">fit_sem</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Spatial Model Results </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Formula: y ~ x</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x560bef75df08&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Spatial method (outcome):  SAR (SEM) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Likelihood function:  auto_gaussian </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Link function:  identity </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Residual Moran Coefficient:  -0.0147 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Observations:  100 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Inference for Stan model: foundation.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 chains, each with iter=800; warmup=400; thin=1; </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> post-warmup draws per chain=400, total post-warmup draws=400.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            mean se_mean    sd   2.5%   20%   50%   80% 97.5% n_eff  Rhat</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> intercept 0.196   0.009 0.176 -0.165 0.046 0.200 0.345 0.530   388 0.998</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x         0.451   0.005 0.098  0.269 0.363 0.450 0.532 0.647   456 0.998</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sar_rho   0.408   0.006 0.112  0.182 0.316 0.417 0.504 0.614   371 0.998</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sar_scale 1.014   0.004 0.072  0.891 0.956 1.006 1.070 1.163   277 1.001</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Samples were drawn using NUTS(diag_e) at Tue Oct 29 10:41:09 2024.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> For each parameter, n_eff is a crude measure of effective sample size,</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> and Rhat is the potential scale reduction factor on split chains (at </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> convergence, Rhat=1).</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">##</span></span></span>
<span class="r-in"><span><span class="co">## data for SDEM</span></span></span>
<span class="r-in"><span><span class="co">##</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># mu = x*beta + wx*gamma; beta=1, gamma=-0.25</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="sim_sar.html">sim_sar</a></span><span class="op">(</span>w <span class="op">=</span> <span class="va">w</span>, rho <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mu</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">*</span> <span class="va">x</span> <span class="op">-</span> <span class="fl">0.25</span> <span class="op">*</span> <span class="op">(</span><span class="va">w</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">x</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="sim_sar.html">sim_sar</a></span><span class="op">(</span>w <span class="op">=</span> <span class="va">w</span>, rho <span class="op">=</span> <span class="fl">.5</span>, mu <span class="op">=</span> <span class="va">mu</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># or for SDLM:</span></span></span>
<span class="r-in"><span><span class="co"># y &lt;- sim_sar(w = w, rho = 0.5, mu = mu, type = "SLM")</span></span></span>
<span class="r-in"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">y</span>, x<span class="op">=</span><span class="va">x</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co">## fit models</span></span></span>
<span class="r-in"><span><span class="co">##</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># DSEM</span></span></span>
<span class="r-in"><span><span class="co"># y = mu + rho*W*(y - mu) + epsilon</span></span></span>
<span class="r-in"><span><span class="co"># mu = beta*x + gamma*Wx</span></span></span>
<span class="r-in"><span><span class="va">fit_sdem</span> <span class="op">&lt;-</span> <span class="fu">stan_sar</span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, data <span class="op">=</span> <span class="va">dat</span>,</span></span>
<span class="r-in"><span>                    sar_parts <span class="op">=</span> <span class="va">sars</span>, type <span class="op">=</span> <span class="st">"SDEM"</span>,</span></span>
<span class="r-in"><span>                    iter <span class="op">=</span> <span class="fl">800</span>, chains <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>                    quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># SDLM</span></span></span>
<span class="r-in"><span><span class="co"># y = rho*Wy + beta*x + gamma*Wx + epsilon</span></span></span>
<span class="r-in"><span><span class="va">fit_sdlm</span> <span class="op">&lt;-</span> <span class="fu">stan_sar</span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, data <span class="op">=</span> <span class="va">dat</span>,</span></span>
<span class="r-in"><span>                    sar_parts <span class="op">=</span> <span class="va">sars</span>,</span></span>
<span class="r-in"><span>                    type <span class="op">=</span> <span class="st">"SDLM"</span>,</span></span>
<span class="r-in"><span>                    iter <span class="op">=</span> <span class="fl">800</span>,</span></span>
<span class="r-in"><span>                    chains <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>                    quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># compare by DIC</span></span></span>
<span class="r-in"><span><span class="fu"><a href="waic.html">dic</a></span><span class="op">(</span><span class="va">fit_sdem</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     DIC penalty </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   316.9     4.7 </span>
<span class="r-in"><span><span class="fu"><a href="waic.html">dic</a></span><span class="op">(</span><span class="va">fit_sdlm</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     DIC penalty </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   318.7     6.0 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="co">##</span></span></span>
<span class="r-in"><span><span class="co">## Modeling mortality rates</span></span></span>
<span class="r-in"><span><span class="co">##</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># simple spatial regression</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">georgia</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">W</span> <span class="op">&lt;-</span> <span class="fu"><a href="shape2mat.html">shape2mat</a></span><span class="op">(</span><span class="va">georgia</span>, style <span class="op">=</span> <span class="st">"W"</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Contiguity condition: queen</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Number of neighbors per unit, summary:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1.000   4.000   5.000   5.409   6.000  10.000 </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Spatial weights, summary:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  0.1000  0.1429  0.1667  0.1849  0.2000  1.0000 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">stan_sar</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">rate.male</span><span class="op">)</span> <span class="op">~</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>                C <span class="op">=</span> <span class="va">W</span>,</span></span>
<span class="r-in"><span>                data <span class="op">=</span> <span class="va">georgia</span>,</span></span>
<span class="r-in"><span>                iter <span class="op">=</span> <span class="fl">900</span></span></span>
<span class="r-in"><span>                <span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> *Setting prior parameters for intercept</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Distribution: normal</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   location scale</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1     -4.2     5</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> *Setting prior for SAR scale parameter (sar_scale)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Distribution: student_t</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   df location scale</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 10        0     3</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> *Setting prior for SAR spatial autocorrelation parameter (sar_rho)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Distribution: uniform</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   lower upper</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  -1.7     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> SAMPLING FOR MODEL 'foundation' NOW (CHAIN 1).</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: Gradient evaluation took 9.7e-05 seconds</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 0.97 seconds.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: Adjust your expectations accordingly!</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: Iteration:   1 / 900 [  0%]  (Warmup)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: Iteration: 451 / 900 [ 50%]  (Sampling)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: Iteration: 900 / 900 [100%]  (Sampling)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1:  Elapsed Time: 0.153 seconds (Warm-up)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1:                0.098 seconds (Sampling)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1:                0.251 seconds (Total)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 1: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> SAMPLING FOR MODEL 'foundation' NOW (CHAIN 2).</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 2: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 2: Gradient evaluation took 5.4e-05 seconds</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 0.54 seconds.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 2: Adjust your expectations accordingly!</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 2: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 2: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 2: Iteration:   1 / 900 [  0%]  (Warmup)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 2: Iteration: 451 / 900 [ 50%]  (Sampling)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 2: Iteration: 900 / 900 [100%]  (Sampling)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 2: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 2:  Elapsed Time: 0.143 seconds (Warm-up)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 2:                0.112 seconds (Sampling)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 2:                0.255 seconds (Total)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 2: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> SAMPLING FOR MODEL 'foundation' NOW (CHAIN 3).</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 3: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 3: Gradient evaluation took 5.5e-05 seconds</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 3: 1000 transitions using 10 leapfrog steps per transition would take 0.55 seconds.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 3: Adjust your expectations accordingly!</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 3: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 3: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 3: Iteration:   1 / 900 [  0%]  (Warmup)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 3: Iteration: 451 / 900 [ 50%]  (Sampling)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 3: Iteration: 900 / 900 [100%]  (Sampling)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 3: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 3:  Elapsed Time: 0.176 seconds (Warm-up)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 3:                0.116 seconds (Sampling)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 3:                0.292 seconds (Total)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 3: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> SAMPLING FOR MODEL 'foundation' NOW (CHAIN 4).</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 4: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 4: Gradient evaluation took 5.4e-05 seconds</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 4: 1000 transitions using 10 leapfrog steps per transition would take 0.54 seconds.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 4: Adjust your expectations accordingly!</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 4: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 4: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 4: Iteration:   1 / 900 [  0%]  (Warmup)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 4: Iteration: 451 / 900 [ 50%]  (Sampling)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 4: Iteration: 900 / 900 [100%]  (Sampling)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 4: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 4:  Elapsed Time: 0.17 seconds (Warm-up)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 4:                0.134 seconds (Sampling)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 4:                0.304 seconds (Total)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chain 4: </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># view fitted vs. observed, etc.</span></span></span>
<span class="r-in"><span><span class="fu"><a href="sp_diag.html">sp_diag</a></span><span class="op">(</span><span class="va">fit</span>, <span class="va">georgia</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="stan_sar-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># A more appropriate model for count data:</span></span></span>
<span class="r-in"><span><span class="co"># hierarchical spatial poisson model</span></span></span>
<span class="r-in"><span><span class="va">fit2</span> <span class="op">&lt;-</span> <span class="fu">stan_sar</span><span class="op">(</span><span class="va">deaths.male</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/offset.html" class="external-link">offset</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">pop.at.risk.male</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                C <span class="op">=</span> <span class="va">W</span>,</span></span>
<span class="r-in"><span>                data <span class="op">=</span> <span class="va">georgia</span>,</span></span>
<span class="r-in"><span>                family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">poisson</a></span><span class="op">(</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                chains <span class="op">=</span> <span class="fl">1</span>, <span class="co"># for ex. speed only</span></span></span>
<span class="r-in"><span>                iter <span class="op">=</span> <span class="fl">900</span>,</span></span>
<span class="r-in"><span>                quiet <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span>                 <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># view fitted vs. observed, etc.</span></span></span>
<span class="r-in"><span><span class="fu"><a href="sp_diag.html">sp_diag</a></span><span class="op">(</span><span class="va">fit2</span>, <span class="va">georgia</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Using sp_diag(y, shape, rates = TRUE, ...). To examine data as (unstandardized) counts, use rates = FALSE.</span>
<span class="r-plt img"><img src="stan_sar-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Connor Donegan.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

